var ae=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var a=(r,e)=>ae(r,"name",{value:e,configurable:!0});var R=(r,e,t,n)=>{for(var o=n>1?void 0:n?Le(e,t):e,i=r.length-1,s;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&ae(e,t,o),o};var de=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function le(r){if(!r)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",enter:"\u23CE"};return r.toLowerCase().split("+").map(ce).map(n=>Object.keys(e).includes(n)?e[n]:n)}a(le,"bindingSymbols");function ce(r){return!de&&r==="meta"?"ctrl":r}a(ce,"filterKeyForNonMacMeta");var K=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let t of this.bindings)if(t.command===e)return t;return null}evaluateEvent(e){e:for(let t of this.bindings){let n=t.key.toLowerCase().split("+");if(n.pop()===e.key.toLowerCase()){for(let i of["shift","ctrl","alt","meta"]){let s=n.includes(i);if(!de){if(i==="meta")continue;i==="ctrl"&&(s=n.includes("meta")||n.includes("ctrl"))}let d=e[`${ce(i)}Key`];if(!d&&s||d&&!s)continue e}return t}}return null}};a(K,"KeyBindings");var Y=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...t){return new Promise(n=>{let o=this.commands[e].action(...t);n(o)})}};a(Y,"CommandRegistry");var G=class{constructor(){this.menus={}}registerMenu(e,t){this.menus[e]=t}};a(G,"MenuRegistry");var q=class{constructor(e){this.commands=new Y,this.keybindings=new K,this.menus=new G,this.backend=e,this.workspace=new W(e.files),this.context={node:null},this.panels=[]}get mainPanel(){return this.panels[0]}async initialize(){await this.workspace.load(),this.workspace.rawNodes.forEach(e=>this.backend.index.index(e)),this.workspace.observe(e=>{this.workspace.save(),e.isDestroyed?this.backend.index.remove(e.id):(this.backend.index.index(e.raw),e.components.forEach(t=>this.backend.index.index(t.raw)))}),this.workspace.lastOpenedID?this.openNewPanel(this.workspace.find(this.workspace.lastOpenedID)||this.workspace.mainNode()):this.openNewPanel(this.workspace.mainNode()),this.backend.loadExtensions&&await this.backend.loadExtensions(),m.redraw(),localStorage.getItem("firsttime")||this.showNotice("firsttime")}authenticated(){return this.backend.auth&&this.backend.auth.currentUser()}closeQuickAdd(){this.quickadd=null,m.redraw()}openQuickAdd(){let e=this.workspace.find("@quickadd");e||(e=this.workspace.new("@quickadd")),this.quickadd=e}commitQuickAdd(){let e=this.workspace.find("@quickadd");if(!e)return;let t=this.todayNode();e.children.forEach(n=>n.parent=t)}clearQuickAdd(){let e=this.workspace.find("@quickadd");e&&e.children.forEach(t=>t.destroy())}todayNode(){let e=new Date,t=e.toUTCString().split(e.getFullYear())[0],n=`Week ${String(Se(e)).padStart(2,"0")}`,i=["@workspace","Calendar",`${e.getFullYear()}`,n,t].join("/"),s=this.workspace.find(i);return s||(s=this.workspace.new(i)),s}openToday(){this.open(this.todayNode())}open(e){this.workspace.expanded[e.id]||(this.workspace.expanded[e.id]={}),this.workspace.lastOpenedID=e.id,this.workspace.save();let t=new D(e);this.panels[0]=t,this.context.path=t}openNewPanel(e){this.workspace.expanded[e.id]||(this.workspace.expanded[e.id]={}),this.workspace.lastOpenedID=e.id,this.workspace.save();let t=new D(e);this.panels.push(t),this.context.path=t}closePanel(e){this.panels=this.panels.filter(t=>t.name!==e.name)}defocus(){this.context.node=null}focus(e,t=0){let n=this.getInput(e);n?(this.context.path=e,n.focus(),t!==void 0&&n.setSelectionRange(t,t)):console.warn("unable to find input for",e)}getInput(e){let t=`input-${e.id}-${e.node.id}`;return e.node.raw.Rel==="Fields"&&(t=t+"-value"),document.getElementById(t)}executeCommand(e,t,...n){return t=this.newContext(t),console.log(e,t,...n),this.commands.executeCommand(e,this.newContext(t),...n)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,t){e.stopPropagation(),e.preventDefault();let n=e.target.closest("*[data-menu]"),o=n.getBoundingClientRect(),i=n.dataset.align||"left",s=document.body.scrollLeft+o.x;i==="right"&&(s=document.body.offsetWidth-o.right);let d=document.body.scrollTop+o.y+o.height,l=this.menus.menus[n.dataset.menu],c=l.filter(u=>u.command).map(u=>this.commands.commands[u.command]);l&&(this.menu={x:s,y:d,ctx:this.newContext(t),items:l,commands:c,align:i},this.curtain={visible:!1,onclick:()=>this.hideMenu()},m.redraw())}hideMenu(){this.menu=null,this.curtain=null,m.redraw()}showPalette(e,t,n){this.palette={x:e,y:t,ctx:n},this.curtain={visible:!1,onclick:()=>this.hidePalette()},m.redraw()}hidePalette(){this.palette=null,this.curtain=null,m.redraw()}showNotice(e,t){this.notice={message:e,finished:t},m.redraw()}hideNotice(){this.notice=null,m.redraw()}};a(q,"Workbench");function Se(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);var n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-n)/864e5+1)/7)}a(Se,"getWeekOfYear");function he(r){function e(E,x){var b=E<<x|E>>>32-x;return b}a(e,"rotate_left");function t(E){var x="",b,N,se;for(b=0;b<=6;b+=2)N=E>>>b*4+4&15,se=E>>>b*4&15,x+=N.toString(16)+se.toString(16);return x}a(t,"lsb_hex");function n(E){var x="",b,N;for(b=7;b>=0;b--)N=E>>>b*4&15,x+=N.toString(16);return x}a(n,"cvt_hex");function o(E){E=E.replace(/\r\n/g,`
`);for(var x="",b=0;b<E.length;b++){var N=E.charCodeAt(b);N<128?x+=String.fromCharCode(N):N>127&&N<2048?(x+=String.fromCharCode(N>>6|192),x+=String.fromCharCode(N&63|128)):(x+=String.fromCharCode(N>>12|224),x+=String.fromCharCode(N>>6&63|128),x+=String.fromCharCode(N&63|128))}return x}a(o,"Utf8Encode");var i,s,d,l=new Array(80),c=1732584193,u=4023233417,p=2562383102,g=271733878,w=3285377520,f,v,h,y,C,T;r=o(r);var A=r.length,P=new Array;for(s=0;s<A-3;s+=4)d=r.charCodeAt(s)<<24|r.charCodeAt(s+1)<<16|r.charCodeAt(s+2)<<8|r.charCodeAt(s+3),P.push(d);switch(A%4){case 0:s=2147483648;break;case 1:s=r.charCodeAt(A-1)<<24|8388608;break;case 2:s=r.charCodeAt(A-2)<<24|r.charCodeAt(A-1)<<16|32768;break;case 3:s=r.charCodeAt(A-3)<<24|r.charCodeAt(A-2)<<16|r.charCodeAt(A-1)<<8|128;break}for(P.push(s);P.length%16!=14;)P.push(0);for(P.push(A>>>29),P.push(A<<3&4294967295),i=0;i<P.length;i+=16){for(s=0;s<16;s++)l[s]=P[i+s];for(s=16;s<=79;s++)l[s]=e(l[s-3]^l[s-8]^l[s-14]^l[s-16],1);for(f=c,v=u,h=p,y=g,C=w,s=0;s<=19;s++)T=e(f,5)+(v&h|~v&y)+C+l[s]+1518500249&4294967295,C=y,y=h,h=e(v,30),v=f,f=T;for(s=20;s<=39;s++)T=e(f,5)+(v^h^y)+C+l[s]+1859775393&4294967295,C=y,y=h,h=e(v,30),v=f,f=T;for(s=40;s<=59;s++)T=e(f,5)+(v&h|v&y|h&y)+C+l[s]+2400959708&4294967295,C=y,y=h,h=e(v,30),v=f,f=T;for(s=60;s<=79;s++)T=e(f,5)+(v^h^y)+C+l[s]+3395469782&4294967295,C=y,y=h,h=e(v,30),v=f,f=T;c=c+f&4294967295,u=u+v&4294967295,p=p+h&4294967295,g=g+y&4294967295,w=w+C&4294967295}var T=n(c)+n(u)+n(p)+n(g)+n(w);return T.toLowerCase()}a(he,"SHA1");var D=class{constructor(e,t){t?this.name=t:this.name=Math.random().toString(36).substring(2),e?this.nodes=[e]:this.nodes=[]}push(e){this.nodes.push(e)}pop(){return this.nodes.pop()||null}sub(){return new D(this.node,this.name)}clone(){let e=new D;return e.name=this.name,e.nodes=[...this.nodes],e}append(e){let t=this.clone();return t.push(e),t}get length(){return this.nodes.length}get id(){return he([this.name,...this.nodes.map(e=>e.id)].join(":"))}get node(){return this.nodes[this.nodes.length-1]}get previous(){return this.nodes.length<2?null:this.nodes[this.nodes.length-2]}get head(){return this.nodes[0]}};a(D,"Path");var oe={};function B(r){oe[O(r)]=r}a(B,"component");function O(r){return r.prototype===void 0&&(r=r.constructor),`treehouse.${r.name}`}a(O,"componentName");function ie(r){return typeof r=="string"?oe[r]:oe[O(r)]}a(ie,"getComponent");function ue(r,e){let t=new(ie(r));return t.fromJSON instanceof Function?t.fromJSON(e):Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),t}a(ue,"inflateToComponent");function z(r,e){return r.value&&r.value[e]instanceof Function}a(z,"hasHook");function M(r,e,...t){if(z(r,e))return r.value[e].apply(r.value,t)}a(M,"triggerHook");function H(r,e){for(let t of r.components)if(z(t,e))return!0;return!1}a(H,"objectHas");function $(r,e,...t){for(let n of r.components)if(z(n,e))return n.value[e].apply(n.value,t)}a($,"objectCall");var Q=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}changed(e){this.observers.forEach(t=>t(e))}import(e){for(let t of e)t.Value&&ie(t.Name)&&(t.Value=ue(t.Name,t.Value),t.Rel="Components"),this.nodes[t.ID]=t;for(let t of e){if(t.Parent==="@tmp"){delete this.nodes[t.ID];continue}if(!t.ID.startsWith("@")&&t.Parent===void 0){delete this.nodes[t.ID];continue}if(t.Parent&&!this.nodes[t.Parent]){delete this.nodes[t.ID];continue}let n=this.find(t.ID);if(n){if(n.parent&&!n.parent.raw){delete this.nodes[t.ID];continue}M(n,"onAttach",n)}}}export(){let e=[];for(let t of Object.values(this.nodes))e.push(t);return e}make(e,t){let n=null;if(e.includes("/")){let s=e.split("/");n=this.find(s[0]);for(let d=1;d<s.length-1;d++){if(n===null)throw"unable to get root";let l=n.find(s[d]);l||(l=this.make(s.slice(0,d+1).join("/"))),n=l}e=s[s.length-1]}let o=e.startsWith("@")?e:De();this.nodes[o]={ID:o,Name:e,Value:t,Linked:{Children:[],Components:[]},Attrs:{}};let i=new I(this,o);return n&&(i.parent=n),i}destroy(e){let t=e.parent;if(t!==null&&!t.isDestroyed){let n=e.raw.Rel||"Children";t.raw.Linked[n].includes(e.id)&&t.raw.Linked[n].splice(e.siblingIndex,1)}delete this.nodes[e.id],t&&this.changed(t)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new I(this,e.ID))}root(e){e=e||"@root";let t=this.roots().find(n=>n.name===e);return t===void 0?null:t}find(e){let t=this.nodes[e];if(t)return new I(this,t.ID);let n=e.split("/");if(n.length===1&&n[0].startsWith("@"))return null;let o=this.root(n[0]);if(!o&&this.nodes[n[0]]&&(o=new I(this,this.nodes[n[0]].ID)),o?n.shift():o=this.root("@root"),!o)return null;let i=a((s,d)=>(s.refTo&&(s=s.refTo),s.children.find(l=>l.name===d)),"findChild");for(let s of n){let d=i(o,s);if(!d)return null;o=d}return o}walk(e,t){for(let n of this.roots())if(n.walk(e,t))return}observe(e){this.observers.push(e)}};a(Q,"Bus");var De=a(()=>{let r=Date.now().toString(36),e=Math.random().toString(36).substring(2);return r+e},"uniqueId");var I=class{constructor(e,t){this._bus=e,this._id=t}[Symbol.for("Deno.customInspect")](){return`Node[${this.id}:${this.name}]`}get id(){return this._id}get bus(){return this._bus}get raw(){let e=this._bus.nodes[this.id];if(!e)throw`use of non-existent node ${this.id}`;return e}get name(){return this.refTo?this.refTo.name:this.raw.Name}set name(e){this.refTo?this.refTo.name=e:this.raw.Name=e,this.changed()}get value(){return this.refTo?this.refTo.value:this.raw.Value}set value(e){this.refTo?this.refTo.value=e:this.raw.Value=e,this.changed()}get parent(){return!this.raw.Parent||!this._bus.nodes[this.raw.Parent]?null:new I(this._bus,this.raw.Parent)}set parent(e){let t=this.parent;t!==null&&t.raw.Linked.Children.splice(this.siblingIndex,1),e!==null?(this.raw.Parent=e.id,e.raw.Linked.Children.push(this.id),M(e,"onAttach",e)):this.raw.Parent=void 0,this.changed()}get refTo(){let e=this.raw.Attrs.refTo;return!e||!this._bus.nodes[e]?null:new I(this._bus,e)}set refTo(e){if(!e){delete this.raw.Attrs.refTo,this.changed();return}this.raw.Attrs.refTo=e.id,this.changed()}get siblingIndex(){let e=this.parent;if(e===null)return 0;let t=this.raw.Rel||"Children";return e.raw.Linked[t].findIndex(n=>n===this.id)}set siblingIndex(e){let t=this.parent;if(t===null)return;let n=this.raw.Rel||"Children";t.raw.Linked[n].splice(this.siblingIndex,1),t.raw.Linked[n].splice(e,0,this.id),t.changed()}get prevSibling(){let e=this.parent;if(e===null||this.siblingIndex===0)return null;let t=this.raw.Rel||"Children";return e.getLinked(t)[this.siblingIndex-1]}get nextSibling(){let e=this.parent;if(e===null||this.siblingIndex===e.children.length-1)return null;let t=this.raw.Rel||"Children";return e.getLinked(t)[this.siblingIndex+1]}get ancestors(){let e=[],t=this.parent;for(;t!==null;)e.push(t),t=t.parent;return e}get isDestroyed(){return!this._bus.nodes.hasOwnProperty(this.id)}get path(){let e=this,t=[];for(;e;)t.unshift(e.name),e=e.parent;return t.join("/")}get children(){if(this.refTo)return this.refTo.children;let e=[];this.raw.Linked.Children&&(e=this.raw.Linked.Children.map(t=>new I(this._bus,t)));for(let t of this.components)if(z(t,"objectChildren"))return M(t,"objectChildren",this,e);return e}get childCount(){if(this.refTo)return this.refTo.childCount;for(let e of this.components)if(z(e,"objectChildren"))return M(e,"objectChildren",this,null).length;return this.raw.Linked.Children?this.raw.Linked.Children.length:0}addChild(e){if(this.refTo){this.refTo.addChild(e);return}this.raw.Linked.Children.push(e.id),this.changed()}removeChild(e){if(this.refTo){this.refTo.removeChild(e);return}let t=this.raw.Linked.Children.filter(n=>n===e.id);this.raw.Linked.Children=t,this.changed()}get components(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new I(this._bus,e)):[]}get componentCount(){return this.raw.Linked.Components?this.raw.Linked.Components.length:0}addComponent(e){let t=this.bus.make(O(e),e);t.raw.Parent=this.id,t.raw.Rel="Components",this.raw.Linked.Components.push(t.id),M(t,"onAttach",t),this.changed()}removeComponent(e){let t=this.components.filter(n=>n.name===O(e));t.length>0&&t[0].destroy(),this.changed()}hasComponent(e){return this.components.filter(n=>n.name===O(e)).length>0}getComponent(e){let t=this.components.filter(n=>n.name===O(e));return t.length>0?t[0].value:null}getLinked(e){return this.raw.Linked[e]?this.raw.Linked[e].map(t=>new I(this._bus,t)):[]}addLinked(e,t){this.raw.Linked[e]||(this.raw.Linked[e]=[]),t.raw.Rel=e,this.raw.Linked[e].push(t.id),this.changed()}removeLinked(e,t){this.raw.Linked[e]||(this.raw.Linked[e]=[]);let n=this.raw.Linked[e].filter(o=>o===t.id);this.raw.Linked[e]=n,this.changed()}moveLinked(e,t,n){this.raw.Linked[e]||(this.raw.Linked[e]=[]);let o=this.raw.Linked[e].findIndex(s=>s===t.id);if(o===-1)return;let i=this.raw.Linked[e];i.splice(n,0,i.splice(o,1)[0]),this.raw.Linked[e]=i,this.changed()}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,t){this.raw.Attrs[e]=t,this.changed()}find(e){return this.bus.find([this.path,e].join("/"))}walk(e,t){if(t=t||{followRefs:!1,includeComponents:!1},e(this))return!0;let n=this.children;if(this.refTo&&t.followRefs){if(e(this.refTo))return!0;n=this.refTo.children}for(let o of n)if(o.walk(e,t))return!0;if(t.includeComponents){for(let o of this.components)if(o.walk(e,t))return!0}return!1}destroy(){if(this.isDestroyed)return;if(this.refTo){this._bus.destroy(this);return}let e=[];this.walk(t=>(e.push(t),!1),{followRefs:!1,includeComponents:!0}),e.reverse().forEach(t=>this._bus.destroy(t))}changed(){this._bus.changed(this)}};a(I,"Node");var W=class{constructor(e){this.fs=e,this.bus=new Q,this.expanded={},this.writeDebounce=Ee(async(t,n)=>{try{await this.fs.writeFile(t,n),console.log("Saved workspace.")}catch(o){console.error(o),document.dispatchEvent(new CustomEvent("BackendError"))}})}get rawNodes(){return this.bus.export()}observe(e){this.bus.observe(e)}save(){this.writeDebounce("workspace.json",JSON.stringify({version:1,lastopen:this.lastOpenedID,expanded:this.expanded,nodes:this.rawNodes},null,2))}async load(){let e=JSON.parse(await this.fs.readFile("workspace.json")||"{}");if(Array.isArray(e)&&(e={version:0,nodes:e}),e.nodes&&(this.bus.import(e.nodes),console.log(`Loaded ${e.nodes.length} nodes.`)),e.expanded)for(let t in e.expanded)for(let n in e.expanded[t])this.bus.find(n)&&(this.expanded[t]||(this.expanded[t]={}),this.expanded[t][n]=e.expanded[t][n]);e.lastopen&&(this.lastOpenedID=e.lastopen)}mainNode(){let e=this.bus.find("@workspace");if(!e){console.info("Building missing workspace node.");let t=this.bus.find("@root"),n=this.bus.make("@workspace");n.name="Workspace",n.parent=t;let o=this.bus.make("@calendar");o.name="Calendar",o.parent=n;let i=this.bus.make("Home");i.parent=n,e=n}return e}find(e){return this.bus.find(e)}new(e,t){return this.bus.make(e,t)}getExpanded(e,t){this.expanded[e.id]||(this.expanded[e.id]={});let n=this.expanded[e.id][t.id];return n===void 0&&(n=!1),n}setExpanded(e,t,n){this.expanded[e.id][t.id]=n,this.save()}findAbove(e){if(e.node.id===e.head.id)return null;let t=e.clone();t.pop();let n=e.node.prevSibling;if(!n){let i=e.previous.getLinked("Fields").length;return e.node.raw.Rel!=="Fields"&&i>0?t.append(e.previous.getLinked("Fields")[i-1]):t}let o=a(i=>{if(!this.getExpanded(e.head,i.node))return i;let d=i.node.getLinked("Fields").length;if(i.node.childCount===0&&d>0){let c=i.node.getLinked("Fields")[d-1];return o(i.append(c))}let l=i.node.children[i.node.childCount-1];return o(i.append(l))},"lastSubIfExpanded");return o(t.append(n))}findBelow(e){let t=e.clone();if(this.getExpanded(e.head,e.node)&&e.node.getLinked("Fields").length>0)return t.append(e.node.getLinked("Fields")[0]);if(this.getExpanded(e.head,e.node)&&e.node.childCount>0)return t.append(e.node.children[0]);let n=a(o=>{let i=o.node.nextSibling;if(i)return o.pop(),o.append(i);let s=o.previous;return s?o.node.raw.Rel==="Fields"&&s.childCount>0?(o.pop(),o.append(s.children[0])):(o.pop(),n(o)):null},"nextSiblingOrParentNextSibling");return n(t)}};a(W,"Workspace");function Ee(r,e=3e3){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,n)},e)}}a(Ee,"debounce");var pe={view({attrs:{workbench:r,x:e,y:t,items:n,align:o,commands:i,ctx:s}}){let d=a((c,u)=>p=>{p.stopPropagation(),!c.disabled&&(c.onclick&&c.onclick(),u&&r.executeCommand(u.id,s),r.hideMenu())},"onclick"),l={left:`${e}px`};return o==="right"&&(l={right:`${e}px`}),m("ul",{class:"menu",style:Object.assign(l,{margin:"0",position:"absolute",top:`${t}px`,display:"inline-block"})},n.filter(c=>!c.when||c.when()).map(c=>{let u="",p,g;return c.command&&(g=i.find(w=>w.id===c.command),p=r.keybindings.getBinding(g.id),u=g.title),c.title&&(u=c.title()),m("li",{onclick:d(c,g),class:c.disabled?"disabled":"",style:{display:"flex"}},m("div",null,u),p&&m("div",{class:"keybindings grow text-right"},le(p.key).join(" ").toUpperCase()))}))}};var me={onupdate({state:r,dom:e}){let t=e.querySelector(".commands").children;r.selected!==void 0&&t.length>0&&t[r.selected].scrollIntoView({block:"nearest"})},oncreate({state:r,dom:e}){e.querySelector("input").focus(),r.selected===void 0&&(r.selected=0)},view({attrs:r,state:e}){let t=r.workbench;e.filter=e.filter===void 0?"":e.filter;let o=Object.values(t.commands.commands).filter(l=>(l.title||l.id).toLowerCase().startsWith(e.filter.toLowerCase())),i=a(l=>{let c=a((u,p)=>(u%p+p)%p,"mod");if(l.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=c(e.selected+1,o.length),!1}if(l.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=c(e.selected-1,o.length),!1;if(l.key==="Enter")return e.selected!==void 0&&(t.commands.executeCommand(o[e.selected].id,r.ctx),t.hidePalette()),!1},"onkeydown"),s=a(l=>{t.commands.executeCommand(l.id,r.ctx),t.hidePalette()},"onclick"),d=a(l=>{e.filter=l.target.value,e.selected=0},"autocomplete");return m("div",{class:"palette",style:{position:"absolute",left:`${r.x}px`,top:`${r.y}px`}},m("div",null,m("input",{style:{width:"98%",outline:"0",border:"0"},type:"text",onkeydown:i,oninput:d,placeholder:"Enter command..."})),m("div",{class:"commands",style:{overflowY:"scroll",position:"relative"}},o.map((l,c)=>m("div",{class:e.selected===c?"selected":"",onclick:()=>s(l)},l.title||l.id))))}};var F={view({attrs:{workbench:r,path:e,onkeydown:t,disallowEmpty:n,editValue:o},state:i}){let s=e.node,d=o?"value":"name",l=a(()=>d==="name"?H(s,"displayName")?$(s,"displayName",s):s.name:s[d]||"","display"),c=a(()=>{i.initialValue=s[d],r.context.node=s,r.context.path=e},"onfocus"),u=a(()=>s[d],"getter"),p=a((f,v)=>{s.isDestroyed||(n&&f.length===0?s[d]=i.initialValue:s[d]=f),v&&(r.context.node=null)},"setter"),g;s.raw.Rel==="Fields"&&(g=o?"Value":"Field");let w=`input-${e.id}-${s.id}`;return d==="value"&&(w=w+"-value"),m(Te,{id:w,getter:u,setter:p,display:l,onkeydown:t,onfocus:c,placeholder:g})}},Te={oncreate({dom:r,attrs:e}){let t=r.querySelector("textarea"),n=t.offsetHeight,o=r.querySelector("span");this.updateHeight=()=>{o.style.width=`${Math.max(t.offsetWidth,100)}px`,o.innerHTML=t.value.replace(`
`,"<br/>"),t.style.height=o.offsetHeight>0?`${o.offsetHeight}px`:`${n}px`},t.addEventListener("input",()=>this.updateHeight()),t.addEventListener("blur",()=>o.innerHTML=""),setTimeout(()=>this.updateHeight(),50),e.onmount&&e.onmount(t)},onupdate(){this.updateHeight()},view({attrs:{id:r,onkeydown:e,onfocus:t,onblur:n,getter:o,setter:i,display:s,placeholder:d},state:l}){let c=l.editing?l.buffer:s?s():o();return m("div",{class:"node-container"},m("textarea",{id:r,rows:"1",onfocus:a(f=>{t&&t(f),l.editing=!0,l.buffer=o()},"startEdit"),onblur:a(f=>{l.editing&&(l.editing=!1,i(l.buffer,!0),l.buffer=void 0),n&&n(f)},"finishEdit"),oninput:a(f=>{l.buffer=f.target.value,i(l.buffer,!1)},"edit"),placeholder:d,onkeydown:e||a(f=>{f.key==="Enter"&&(f.preventDefault(),f.stopPropagation())},"defaultKeydown"),value:c},c),m("span",{style:{visibility:"hidden",position:"fixed"}}))}};var fe={view({attrs:{node:r,workbench:e,panel:t}}){return m("div",{class:"empty-view"})}};var ge={view({attrs:{workbench:r,path:e}}){return m("div",{class:"new-node flex flex-row items-center"},m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7"}),m("path",{style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{class:"flex grow"},m("input",{class:"grow",type:"text",oninput:a(o=>{r.executeCommand("insert-child",{node:e.node,path:e},o.target.value)},"startNew"),onkeydown:a(o=>{if(o.key==="Tab"&&(o.stopPropagation(),o.preventDefault(),node.childCount>0)){let i=e.node.children[e.node.childCount-1];r.executeCommand("insert-child",{node:i,path:e})}},"tabNew"),value:""})))}};var we={view({attrs:{workbench:r,path:e}}){let t=e.node;return e.node.refTo&&(t=e.node.refTo),m("div",{class:"list-view"},m("div",{class:"fields"},t.getLinked("Fields").length>0&&t.getLinked("Fields").map(n=>m(J,{key:n.id,workbench:r,path:e.append(n)}))),m("div",{class:"children"},t.childCount>0?t.children.map(n=>m(J,{key:n.id,workbench:r,path:e.append(n)})):m(ge,{workbench:r,path:e})))}};var ve={view({attrs:{workbench:r,path:e},state:t}){let n=e.node;t.fields=t.fields===void 0?new Set:t.fields,n.children.forEach(i=>{i.getLinked("Fields").forEach(s=>t.fields.add(s.name))});let o=a((i,s)=>{let d=i.getLinked("Fields").filter(l=>l.name===s);return d.length===0?"":m(F,{editValue:!0,workbench:r,path:e.append(d[0])})},"getFieldEditor");return m("table",{class:"table-view",style:{gridTemplateColumns:`repeat(${t.fields.size+1}, 1fr)`}},m("thead",null,m("tr",null,m("th",null),[...t.fields].map(i=>m("th",null,i)))),m("tbody",null,n.children.map(i=>m("tr",null,m("td",null,m(J,{key:i.id,workbench:r,path:e.append(i)})),[...t.fields].map(s=>m("td",null,o(i,s)))))))}};var ke={list:we,table:ve};function re(r){return ke[r]||fe}a(re,"getView");window.registerView=(r,e)=>{ke[r]=e,workbench.commands.registerCommand({id:`view-${r}`,title:`View as ${Re(r)}`,action:t=>{t.node&&t.node.setAttr("view",r)}})};function Re(r){return r.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}a(Re,"toTitleCase");var X={view({attrs:{workbench:r,path:e}}){return m(re(e.node.getAttr("view")||"list"),{workbench:r,path:e})}},J={view({attrs:r,state:e,children:t}){let{path:n,workbench:o}=r,i=n.node,s=!1,d=i;i.refTo&&(s=!0,i=d.refTo);let l=o.workspace.getExpanded(n.head,d),c=a(h=>{e.hover=!0,h.stopPropagation()},"hover"),u=a(h=>{e.hover=!1,h.stopPropagation()},"unhover"),p=a(h=>{l?o.executeCommand("collapse",{node:d,path:n}):o.executeCommand("expand",{node:d,path:n}),h.stopPropagation()},"toggle"),g=a(h=>{let y=h.shiftKey||h.metaKey||h.altKey||h.ctrlKey;switch(h.key){case"ArrowUp":h.target.selectionStart!==0&&!y&&h.stopPropagation();break;case"ArrowDown":h.target.selectionStart!==h.target.value.length&&h.target.selectionStart!==0&&!y&&h.stopPropagation();break;case"Backspace":if(h.target.value===""){if(h.preventDefault(),h.stopPropagation(),i.childCount>0)return;o.executeCommand("delete",{node:i,path:n,event:h});return}if(h.target.value!==""&&h.target.selectionStart===0&&h.target.selectionEnd===0){h.preventDefault(),h.stopPropagation();let C=o.workspace.findAbove(n);if(!C)return;let A=C.node.name;C.node.name=A+h.target.value,i.destroy(),m.redraw.sync(),o.focus(C,A.length);return}break;case"Enter":if(h.preventDefault(),h.ctrlKey||h.shiftKey||h.metaKey||h.altKey)return;if(h.target.selectionStart===h.target.value.length){i.childCount>0&&o.workspace.getExpanded(n.head,i)?o.executeCommand("insert-child",{node:i,path:n},"",0):o.executeCommand("insert",{node:i,path:n}),h.stopPropagation();return}if(h.target.selectionStart===0){o.executeCommand("insert-before",{node:i,path:n}),h.stopPropagation();return}if(h.target.selectionStart>0&&h.target.selectionStart<h.target.value.length){o.executeCommand("insert",{node:i,path:n},h.target.value.slice(h.target.selectionStart)).then(()=>{i.name=h.target.value.slice(0,h.target.selectionStart)}),h.stopPropagation();return}break}},"checkCommands"),w=a(h=>{h.preventDefault(),h.stopPropagation(),o.executeCommand("open",{node:i,path:n}),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},"open"),f=a(h=>h.childCount+h.getLinked("Fields").length,"subCount"),v=a(()=>i.id===o.context?.node?.id||e.hover?!0:i.name.length>0,"showHandle");return m("div",{onmouseover:c,onmouseout:u},m("div",{class:"node-row-outer-wrapper flex flex-row items-start"},m("svg",{class:"node-menu shrink-0",xmlns:"http://www.w3.org/2000/svg",onclick:h=>o.showMenu(h,{node:d,path:n}),oncontextmenu:h=>o.showMenu(h,{node:d,path:n}),"data-menu":"node",viewBox:"0 0 16 16"},e.hover&&m("path",{style:{transform:"translateY(-1px)"},"fill-rule":"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"})),m("div",{class:"node-handle shrink-0",onclick:p,ondblclick:w,oncontextmenu:h=>o.showMenu(h,{node:d,path:n}),"data-menu":"node",style:{display:v()?"block":"none"}},H(i,"handleIcon")?$(i,"handleIcon"):m("svg",{class:"node-bullet",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},f(i)>0&&!l?m("circle",{id:"node-collapsed-handle",cx:"8",cy:"7",r:"7"}):null,m("circle",{cx:"8",cy:"7",r:"3",fill:"currentColor"}),",",s?m("circle",{id:"node-reference-handle",cx:"8",cy:"7",r:"7",fill:"none","stroke-width":"1",stroke:"currentColor","stroke-dasharray":"3,3"}):null)),i.raw.Rel==="Fields"?m("div",{class:"flex grow items-start flex-row"},m("div",null,m(F,{workbench:o,path:n,onkeydown:g})),m(F,{editValue:!0,workbench:o,path:n,onkeydown:g})):m("div",{class:"flex grow items-start flex-row"},H(i,"beforeEditor")&&m($(i,"beforeEditor"),{node:i}),m(F,{workbench:o,path:n,onkeydown:g}),H(i,"afterEditor")&&m($(i,"afterEditor"),{node:i}))),H(i,"belowEditor")&&m($(i,"belowEditor"),{node:i}),l===!0&&m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex",onclick:p}),m("div",{class:"view grow"},m(re(i.getAttr("view")||"list"),{workbench:o,path:n}))))}};var L=class{constructor(){this.markdown=""}};a(L,"Page"),L=R([B],L);var ye={view({attrs:r}){let e=r.path,t=r.workbench,n=e.node,o=a(c=>{t.executeCommand("close-panel",{},e)},"close"),i=a(c=>{e.pop()},"goBack"),s=a(c=>{t.panels=[e],t.context.path=e},"maximize"),d=a(c=>{n.getComponent(L).markdown=c.target.value,n.changed()},"editMarkdown");function l(c=""){return 20+(c.match(/\n/g)||[]).length*20}return a(l,"calcHeight"),m("div",{class:"panel flex flex-col grow"},m("div",{class:"bar flex"},e.length>1?m("div",{class:"panel-back",style:{rightPadding:"var(--padding)"}},m("svg",{onclick:i,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{class:"panel-back-parent grow"},n.parent&&n.parent.id!=="@root"?m("span",{style:{cursor:"pointer"},onclick:()=>t.open(n.parent)},n.parent.name):m("span",null,"\xA0")),t.panels.length>1?m("div",{class:"panel-icons flex items-center"},m("svg",{onclick:s,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-maximize-2"},m("polyline",{points:"15 3 21 3 21 9"}),m("polyline",{points:"9 21 3 21 3 15"}),m("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),m("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),m("svg",{onclick:o,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},m("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null),m("div",{class:"body flex flex-col"},m("div",{class:"title-node",oncontextmenu:c=>t.showMenu(c,{node:n,path:e}),"data-menu":"node"},m(F,{workbench:t,path:e,disallowEmpty:!0})),n.hasComponent(L)?m("textarea",{oninput:d,value:n.getComponent(L).markdown,placeholder:"Enter Markdown text here",style:{marginLeft:"var(--padding)",padding:"var(--padding)",outline:"0",height:`${l(n.getComponent(L).markdown)}px`,border:"0"}},n.getComponent(L).markdown):null,m(X,{workbench:t,path:e.sub()})))}};var xe={view({attrs:{workbench:r}}){let e=new D(r.quickadd,"quickadd");return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>r.closeQuickAdd(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{class:"notice",style:{position:"relative",marginLeft:"auto",marginRight:"auto",marginTop:"20vh"}},m("h3",null,"Quick Add"),m(X,{workbench:r,path:e}),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{r.commitQuickAdd(),r.closeQuickAdd()}},"Add to Today"))))}};var be={onupdate({state:r,dom:e}){let t=e.querySelector(".results");t&&r.selected!==void 0&&t.children.length>0&&t.children[r.selected].scrollIntoView({block:"nearest"})},view({attrs:{workbench:r},state:e}){e.query=e.query===void 0?"":e.query,e.results=e.results===void 0?[]:e.results;let t=a(()=>{e.query="",e.results=[],r.curtain=null},"clear"),n=a(s=>{r.open(s),t()},"open"),o=a(s=>{let d=a((l,c)=>(l%c+c)%c,"mod");if(s.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=d(e.selected+1,e.results.length),!1}if(s.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=d(e.selected-1,e.results.length),!1;if(s.key==="Enter")return e.selected!==void 0&&n(e.results[e.selected]),!1;s.key==="Escape"&&t()},"onkeydown"),i=a(s=>{if(e.query=s.target.value,e.selected=0,e.query){let d=e.query.split(/[ ]+/),l=d.filter(u=>!u.includes(":")).join(" "),c=Object.fromEntries(d.filter(u=>u.includes(":")).map(u=>u.toLowerCase().split(":")));!l&&Object.keys(c).length>0&&(l=Object.keys(c)[0]),e.results=r.backend.index.search(l).map(u=>{let p=r.workspace.find(u);if(p&&!(p.value&&(p=p.parent,!p.raw))){if(Object.keys(c).length>0){let g={};for(let w of p.getLinked("Fields"))g[w.name.toLowerCase()]=w.value.toLowerCase();for(let w in c)if(!g[w]||g[w]!==c[w])return}return p}}).filter(u=>u!==void 0)}else e.results=[];e.query&&e.results.length>0?r.curtain={visible:!1,onclick:()=>t()}:r.curtain=null},"autocomplete");return m("div",{class:e.results.length>0?"search active flex grow":"search flex grow"},m("div",null,m("div",{class:"flex",style:{margin:e.results.length>0?"0":"1px"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),m("input",{type:"text",placeholder:"Search",value:e.query,onkeydown:o,oninput:i,style:{border:"0",outline:"0",background:"transparent",paddingTop:"3px"}})),e.results.length>0?m("div",{class:"results",style:{overflowX:"hidden",overflowY:"auto",maxHeight:"400px"}},e.results.map((s,d)=>m("div",{onclick:()=>n(s),class:e.selected===d?"selected":""},s.name))):null))}};var Be={view({attrs:{workbench:r,finished:e}}){return m("div",null,m("h3",null,"Refresh to view latest updates"),m("p",null,"Your notes were updated in another browser session. Refresh the page to view the latest version."),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{e()}},"Refresh Now")))}},Pe={view({attrs:{workbench:r}}){return m("div",null,m("h3",null,"Treehouse is under active development"),m("p",null,"This is a preview based on our main branch, which is actively being developed."),m("p",null,"If you find a bug, please report it via [ ",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.25rem",marginRight:"0.25rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}))," > Submit Issue ]."),m("p",null,"Data is stored using localstorage, which you can reset via [ ",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.25rem",marginRight:"0.25rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}))," > Reset Demo ]."),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{localStorage.setItem("firsttime","1"),r.hideNotice()}},"Got it")))}},Fe={view({attrs:{workbench:r,finished:e}}){return m("div",null,m("h3",null,"Login with GitHub"),m("p",null,"The GitHub backend is experimental so use at your own risk!"),m("p",null,"To store your workbench we will create a public repository called ",m("pre",{style:{display:"inline"}},"<username>.treehouse.sh")," if it doesn't already exist. You can manually make this repository private via GitHub if you want."),m("p",null,"You can Logout via the",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.5rem",marginRight:"0.5rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})),"menu in the top right to return to the localstorage backend."),m("div",{class:"button-bar"},m("button",{onclick:()=>{r.hideNotice()}},"Cancel"),m("button",{class:"primary",onclick:()=>{r.hideNotice(),localStorage.setItem("github","1"),e()}},"Log in with GitHub")))}},Ce={view({attrs:{workbench:r,message:e,finished:t}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{class:"notice",style:{position:"relative",marginLeft:"auto",marginRight:"auto",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh"}},m({firsttime:Pe,github:Fe,lockstolen:Be}[e],{workbench:r,finished:t})))}};var Ne={view({attrs:{workbench:r},state:e}){e.open=e.open===void 0?!0:e.open;let t=a(n=>{e.open?e.open=!1:e.open=!0},"toggle");return m("main",{class:"workbench m-0 flex flex-row absolute inset-0",style:{overflow:"none"}},m("div",{class:"sidebar flex flex-col",style:{width:e.open?"256px":"52px"}},m("div",{class:"sidebar-topsection",style:{height:"56px"}},m("img",{class:"logo",src:"/icon_transparent.png",style:{width:"20px",height:"20px"}})),m("div",{class:"grow sidebar-maincontent"},e.open&&r.workspace.bus.root().children.map(n=>m(Ie,{node:n,expanded:!0,level:0,workbench:r}))),m("div",{class:"sidebar-bottomsection"},m("svg",{onclick:t,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sidebar"},m("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"9",y1:"3",x2:"9",y2:"21"})))),m("div",{class:"main flex flex-col grow"},m("div",{class:"topbar flex"},m("div",{class:"topbar-item",onclick:()=>r.openToday(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar"},m("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m("line",{x1:"3",y1:"10",x2:"21",y2:"10"})),m("div",null,"Today")),m("div",{class:"topbar-item",onclick:()=>r.openQuickAdd(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"var(--1)"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-circle"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),m("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),m("div",null,"Quick Add")),m(be,{workbench:r}),m("div",{onclick:n=>r.showMenu(n),"data-menu":"settings","data-align":"right",style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})))),m("div",{class:"panels flex flex-row",style:{position:"relative",overflow:"hidden"}},r.panels.map(n=>m("div",{style:{flex:"1 1 auto",overflowY:"auto"}},m(ye,{workbench:r,path:n}))))),r.curtain&&m("div",{onclick:r.curtain.onclick,style:{zIndex:"10",position:"absolute",background:"black",opacity:r.curtain.visible?"50%":"0%",width:"100%",height:"100%"}}),r.menu&&m(pe,{workbench:r,...r.menu}),r.palette&&m(me,{workbench:r,...r.palette}),r.quickadd&&m(xe,{workbench:r}),r.notice&&m(Ce,{workbench:r,...r.notice}))}},Ie={view({attrs:{node:r,workbench:e,expanded:t,level:n},state:o}){o.expanded=o.expanded===void 0?t:o.expanded;let i=r.childCount>0&&n<3,s=a(l=>{i&&(o.expanded?o.expanded=!1:o.expanded=!0,l.stopPropagation())},"toggle"),d=a(l=>{e.open(r)},"open");return m("div",null,m("div",{style:{display:"flex",paddingBottom:"var(--2)"}},m("svg",{onclick:s,style:{cursor:"pointer",flexShrink:"0",paddingTop:"0px",marginRight:"0.125rem"},class:"feather feather-chevron-right",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",xmlns:"http://www.w3.org/2000/svg"},i?o.expanded?m("polyline",{points:"6 9 12 15 18 9"}):m("polyline",{points:"9 18 15 12 9 6"}):null),m("div",{onclick:d,style:{cursor:"pointer",lineHeight:"1.25",fontSize:"0.875rem",flexGrow:"1",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},r.name)),o.expanded&&m("div",{style:{marginLeft:"0.5rem"}},r.children.filter(l=>l.name!=="").map(l=>m(Ie,{workbench:e,node:l,level:n+1}))))}};function je(r,e=1e3){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,n)},e)}}a(je,"debounce");var U=class{constructor(){this.index=window.workbench.backend.index,this.searchDebounce=je(this.search.bind(this))}handleIcon(){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}))}displayName(e){return`Search for "${e.name}"`}onAttach(e){this.component=e,this.object=e.parent,e.bus.observe(t=>{e.isDestroyed||this.searchDebounce()})}search(){if(console.log("searched"),!this.object)return;let e=this.object.name,t=e.split(/[ ]+/),n=t.filter(s=>!s.includes(":")).join(" "),o=Object.fromEntries(t.filter(s=>s.includes(":")).map(s=>s.toLowerCase().split(":")));!n&&Object.keys(o).length>0&&(n=Object.keys(o)[0]);let i=this.index.search(n).map(s=>{let d=window.workbench.workspace.find(s);if(d&&!(d.value&&(d=d.parent,!d.raw))){if(Object.keys(o).length>0){let l={};for(let c of d.getLinked("Fields"))l[c.name.toLowerCase()]=c.value.toLowerCase();for(let c in o)if(!l[c]||l[c]!==o[c])return}return d}}).filter(s=>s!==void 0).filter(s=>s.id!==this.object.id&&s.id!==this.component.id);(i.length!==this.lastResultCount||e!==this.lastQuery)&&(this.results&&this.results.forEach(s=>s.destroy()),this.results=i.map(s=>{let d=this.object.bus.make("");return d.raw.Parent="@tmp",d.refTo=s,d}),this.lastQuery=e,this.lastResultCount=i.length)}objectChildren(e,t){return this.results||this.search(),this.results}toJSON(e){return{}}fromJSON(e){}};a(U,"SearchNode"),U=R([B],U);var S=class{constructor(){this.checked=!1}beforeEditor(){return Oe}};a(S,"Checkbox"),S=R([B],S);var Oe={view({attrs:{node:r}}){return m("input",{type:"checkbox",style:{marginTop:"0.3rem",marginRight:"0.5rem"},onclick:a(t=>{let n=r.getComponent(S);n.checked=!n.checked,r.changed()},"toggleCheckbox"),checked:r.getComponent(S).checked})}};var j=class{constructor(){}handleIcon(){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("polyline",{points:"4 7 4 4 20 4 20 7"}),m("line",{x1:"9",y1:"20",x2:"15",y2:"20"}),m("line",{x1:"12",y1:"4",x2:"12",y2:"20"}))}};a(j,"TextField"),j=R([B],j);var k=class{constructor(){this.log=[],this.showLog=!1}onAttach(e){this.component=e,this.object=e.parent}fromJSON(e){e.startedAt&&(this.startedAt=new Date(e.startedAt)),this.log=(e.log||[]).map(t=>[new Date(t[0]),new Date(t[1])]),this.showLog=e.showLog}toJSON(e){return{startedAt:this.startedAt,log:this.log,showLog:this.showLog}}localTotal(){return this.log.map(this.entryDuration).reduce((e,t)=>e+t,0)}grandTotal(){let e=this.localTotal();return this.object&&this.object.children.forEach(t=>{t.hasComponent(k)&&(e+=t.getComponent(k).grandTotal())}),e}start(){this.startedAt||(this.startedAt=new Date)}stop(){if(!this.startedAt)return;let e=new Date;(e.getTime()-this.startedAt.getTime())/1e3>=60&&this.log.push([this.startedAt,e]),this.startedAt=void 0}formatEntry(e){return e.length!==2?"":`${this.formatDate(e[0])} - ${new Intl.DateTimeFormat("en",{timeStyle:"short"}).format(e[1])}`}entryDuration(e){let t=e[0];return((e[1]||new Date).getTime()-t.getTime())/1e3}formatDate(e){return e?new Intl.DateTimeFormat("en",{dateStyle:"short",timeStyle:"short"}).format(e):""}formatDuration(e){let t=e/60,n=Math.floor(t%60);return t=t/60,`${Math.floor(t%60)}:${n.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}`}afterEditor(){return Me}belowEditor(){return He}static initialize(e){e.commands.registerCommand({id:"stop-clock",title:"Stop clock",action:t=>{if(t.node){if(!t.node.hasComponent(k)){let n=new k;t.node.addComponent(n)}t.node.getComponent(k).stop(),t.node.changed()}}}),e.keybindings.registerBinding({command:"stop-clock",key:"meta+o"}),e.commands.registerCommand({id:"start-clock",title:"Start clock",action:t=>{if(t.node){if(!t.node.hasComponent(k)){let n=new k;t.node.addComponent(n)}t.node.getComponent(k).start(),t.node.changed()}}}),e.keybindings.registerBinding({command:"start-clock",key:"meta+i"}),e.commands.registerCommand({id:"remove-clock",title:"Remove clock",action:t=>{t.node&&t.node.removeComponent(k)}})}};a(k,"Clock"),k=R([B],k);var Me={view({attrs:{node:r}}){let e=r.getComponent(k),t=a(()=>{e.showLog=!e.showLog,r.changed()},"toggleLog");return!e.showLog&&e.startedAt?m("div",{onclick:t,class:"flex flex-row items-center",style:{background:"green",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{class:"blink",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration([e.startedAt])))):m("div",{onclick:t,class:"flex flex-row items-center",style:{background:"gray",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.grandTotal())))}},He={view({attrs:{node:r}}){let e=r.getComponent(k);if(e.showLog)return m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex"}),m("div",{class:"grow"},e.startedAt&&m("div",{class:"flex flex-row",style:{marginBottom:"2px"}},m("div",{class:"grow"},e.formatDate(e.startedAt)," - ..."),m("div",{class:"flex flex-row items-center",style:{background:"green",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{class:"blink",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration([e.startedAt]))))),e.log.toReversed().map(t=>m("div",{class:"flex flex-row",style:{marginBottom:"2px"}},m("div",{class:"grow"},e.formatEntry(t)),m("div",{class:"flex flex-row items-center",style:{background:"#aaa",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration(t))))))))}};var V=class{constructor(){this.auth=null,this.files=new ee,window.MiniSearch?this.index=new _:this.index=new Z}};a(V,"BrowserBackend");var _=class{constructor(){this.indexer=new MiniSearch({idField:"ID",fields:["ID","Name","Value","Value.markdown"],storeFields:["ID"],extractField:(e,t)=>t.split(".").reduce((n,o)=>n&&n[o],e)})}index(e){this.indexer.has(e.ID)?this.indexer.replace(e):this.indexer.add(e)}remove(e){try{this.indexer.discard(e)}catch{}}search(e){let t=this.indexer.autoSuggest(e);return t.length===0?[]:this.indexer.search(t[0].suggestion,{prefix:!0}).map(n=>n.ID)}};a(_,"SearchIndex_MiniSearch");var Z=class{constructor(){this.nodes={}}index(e){this.nodes[e.ID]=e.Name}remove(e){delete this.nodes[e]}search(e){let t=[];for(let n in this.nodes)this.nodes[n].includes(e)&&t.push(n);return t}};a(Z,"SearchIndex_Dumb");var ee=class{async readFile(e){return localStorage.getItem(`treehouse:${e}`)}async writeFile(e,t){localStorage.setItem(`treehouse:${e}`,t)}};a(ee,"FileStore");import{encode as $e,decode as Ue}from"https://cdn.jsdelivr.net/npm/js-base64@3.7.5/base64.mjs";var te=class{constructor(e,t,n){this.loginURL=e,this.clientFactory=t,this.auth=this,this.shas={},this.opts=Object.assign({domain:"treehouse.sh",checkDomain:!1},n||{});let o=new V;this.index=o.index,this.files=o.files}get repo(){return`${this.user?.userID()}.${this.opts.domain}`}async initialize(){let e=new URL(location.href).searchParams.get("code");if(e)try{let i=location.search.replace(/\bcode=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${i}`);let d=await(await fetch(this.loginURL,{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({code:e})})).json();if(d.error)throw d.error;localStorage.setItem("treehouse:gh-token",d.token)}catch(i){this.reset(),console.error(i);return}let t=new URL(location.href).searchParams.get("access_token");if(t)try{let i=location.search.replace(/\baccess_token=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${i}`),localStorage.setItem("treehouse:gh-token",t)}catch(i){this.reset(),console.error(i);return}try{if(await this.authenticate(),!this.user)throw"authentication failed"}catch(i){console.error(i),this.opts.authFallbackURL&&(location.href=this.opts.authFallbackURL);return}if(this.opts.checkDomain&&this.repo!==location.hostname){location.hostname=this.repo;return}try{await this.client.rest.repos.get({owner:this.user.userID(),repo:this.repo})}catch(i){if(i.message!=="Not Found")throw i;console.log("Creating repository...");let s=await this.client.rest.repos.createForAuthenticatedUser({name:this.repo});if(s.status!==201){console.error(s);return}}try{await this.client.rest.repos.getContent({owner:this.user.userID(),repo:this.repo,path:"workspace.json"})}catch(i){if(i.name!=="HttpError")throw i;console.log("Creating workspace.json...");let s=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user.userID(),repo:this.repo,path:"workspace.json",message:"initial commit",content:btoa(JSON.stringify([]))});if(s.status!==201){console.error(s);return}}this.files=this;let n=qe();await this.readFile("treehouse.lock"),await this.writeFile("treehouse.lock",n);let o=setInterval(async()=>{await this.readFile("treehouse.lock")!==n&&(clearInterval(o),document.dispatchEvent(new CustomEvent("BackendError")),console.warn("lock stolen!"))},5e3)}async loadExtensions(){try{if((await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:"",random:Math.random().toString(36).substring(2)})).data.find(t=>t.type==="dir"&&t.name==="ext")){let t=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:"ext",random:Math.random().toString(36).substring(2)});for(let n of t.data)if(n.name.endsWith(".css")){let o=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:n.path,random:Math.random().toString(36).substring(2)}),i=document.createElement("link");i.setAttribute("href",`data:text/css;charset=utf-8;base64,${o.data.content}`),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),document.head.appendChild(i)}else if(n.name.endsWith(".js")){let o=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:n.path,random:Math.random().toString(36).substring(2)}),i=document.createElement("script");i.setAttribute("type","module"),i.setAttribute("src",`data:text/javascript;charset=utf-8;base64,${o.data.content}`),document.head.appendChild(i)}}}catch{}}async authenticate(){let e=localStorage.getItem("treehouse:gh-token");if(!e)return;this.client=new this.clientFactory({auth:e});let t=await this.client.rest.users.getAuthenticated();!t||t.error||(this.user=new ne(t.data),m&&m.redraw())}currentUser(){return this.user}login(){location.assign(this.loginURL)}reset(){localStorage.removeItem("treehouse:gh-token"),this.user=null,m&&m.redraw()}logout(){this.reset(),location.reload()}async readFile(e){try{let t=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:e,random:Math.random().toString(36).substring(2)});return this.shas[e]=t.data.sha,Ue(t.data.content)}catch(t){return t.name!=="HttpError"&&console.error(t),null}}async writeFile(e,t){let n=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user?.userID(),repo:this.repo,path:e,message:"autosave",content:$e(t),sha:this.shas[e]});this.shas[e]=n.data.content.sha}};a(te,"GitHubBackend");var ne=class{constructor(e){this.user=e}userID(){return this.user.login}displayName(){return this.user.name}avatarURL(){return this.user.avatar_url}};a(ne,"User");function qe(){let r=Date.now().toString(36),e=Math.random().toString(36).substring(2);return r+e}a(qe,"uniqueID");async function to(r,e,t){t.initialize&&await t.initialize();let n=new q(t);window.workbench=n,await n.initialize(),[k,j,L,S].forEach(o=>{o.initialize&&o.initialize(n)}),r.addEventListener("BackendError",()=>{n.showNotice("lockstolen",()=>{location.reload()})}),n.commands.registerCommand({id:"create-search",title:"Create Search Node",action:o=>{if(!o.node)return;let i=new U;o.node.addComponent(i),n.workspace.setExpanded(o.path.head,o.node,!0)}}),n.commands.registerCommand({id:"view-list",title:"View as List",action:o=>{o.node&&o.node.setAttr("view","list")}}),n.commands.registerCommand({id:"view-table",title:"View as Table",action:o=>{o.node&&o.node.setAttr("view","table")}}),n.commands.registerCommand({id:"add-page",title:"Add page",action:o=>{if(!o.node)return;let i=new L;o.node.addComponent(i)}}),n.commands.registerCommand({id:"remove-page",title:"Remove page",action:o=>{o.node&&o.node.removeComponent(L)}}),n.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",action:o=>{if(!o.node)return;let i=new S;o.node.addComponent(i)}}),n.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",action:o=>{o.node&&o.node.removeComponent(S)}}),n.commands.registerCommand({id:"create-field",title:"Create Field",action:o=>{if(!o.node||o.node.childCount>0||o.node.componentCount>0)return;let i=o.path.clone();i.pop();let s=n.workspace.new(o.node.name,"");s.raw.Parent=o.node.parent.id;let d=new j;s.addComponent(d),o.node.parent.addLinked("Fields",s),i.push(s),o.node.destroy(),m.redraw.sync(),n.focus(i)}}),n.commands.registerCommand({id:"mark-done",title:"Mark done",action:o=>{if(o.node)if(o.node.hasComponent(S)){let i=o.node.getComponent(S);i.checked?o.node.removeComponent(S):(i.checked=!0,o.node.changed())}else{let i=new S;o.node.addComponent(i)}}}),n.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),n.commands.registerCommand({id:"expand",title:"Expand",action:o=>{o.node&&(n.workspace.setExpanded(o.path.head,o.node,!0),m.redraw())}}),n.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),n.commands.registerCommand({id:"collapse",title:"Collapse",action:o=>{o.node&&(n.workspace.setExpanded(o.path.head,o.node,!1),m.redraw())}}),n.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),n.commands.registerCommand({id:"indent",title:"Indent",action:o=>{if(!o.node||o.node.raw.Rel==="Fields")return;let i=o.node,s=o.path.clone(),d=i.prevSibling;d!==null&&(s.pop(),s.push(d),i.parent=d,s.push(i),n.workspace.setExpanded(o.path.head,d,!0),m.redraw.sync(),n.focus(s))}}),n.keybindings.registerBinding({command:"indent",key:"tab"}),n.commands.registerCommand({id:"outdent",title:"Outdent",action:o=>{if(!o.node||o.node.raw.Rel==="Fields")return;let i=o.node,s=o.path.previous,d=o.path.clone();s!==null&&s.id!=="@root"&&(d.pop(),d.pop(),i.parent=s.parent,d.push(i),i.siblingIndex=s.siblingIndex+1,s.childCount===0&&n.workspace.setExpanded(o.path.head,s,!1),m.redraw.sync(),n.focus(d))}}),n.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),n.commands.registerCommand({id:"move-up",title:"Move Up",action:o=>{if(!o.node)return;let i=o.node,s=i.parent;if(s!==null&&s.id!=="@root"){let d=s.childCount;if(i.siblingIndex===0){if(!s.prevSibling)return;let l=o.path.clone();l.pop(),l.pop();let c=s.prevSibling;l.push(c),l.push(i),i.parent=c,i.siblingIndex=c.childCount-1,n.workspace.setExpanded(o.path.head,c,!0),m.redraw.sync(),n.focus(l)}else{if(d===1)return;i.siblingIndex=i.siblingIndex-1,m.redraw.sync()}}}}),n.keybindings.registerBinding({command:"move-up",key:"shift+meta+arrowup"}),n.commands.registerCommand({id:"move-down",title:"Move Down",action:o=>{if(!o.node)return;let i=o.node,s=i.parent;if(s!==null&&s.id!=="@root"){let d=s.childCount;if(i.siblingIndex===d-1){if(!s.nextSibling)return;let l=o.path.clone();l.pop(),l.pop();let c=s.nextSibling;l.push(c),l.push(i),i.parent=c,i.siblingIndex=0,n.workspace.setExpanded(o.path.head,c,!0),m.redraw.sync(),n.focus(l)}else{if(d===1)return;i.siblingIndex=i.siblingIndex+1,m.redraw.sync()}}}}),n.keybindings.registerBinding({command:"move-down",key:"shift+meta+arrowdown"}),n.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(o,i="",s)=>{if(!o.node)return;let d=n.workspace.new(i);d.parent=o.node,s!==void 0&&(d.siblingIndex=s),n.workspace.setExpanded(o.path.head,o.node,!0),m.redraw.sync(),n.focus(o.path.append(d),i.length)}}),n.commands.registerCommand({id:"insert-before",title:"Insert Before",action:o=>{if(!o.node)return;let i=n.workspace.new("");i.parent=o.node.parent,i.siblingIndex=o.node.siblingIndex,m.redraw.sync();let s=o.path.clone();s.pop(),n.focus(s.append(i))}}),n.commands.registerCommand({id:"insert",title:"Insert Node",action:(o,i="")=>{if(!o.node)return;let s=n.workspace.new(i);s.parent=o.node.parent,s.siblingIndex=o.node.siblingIndex+1,m.redraw.sync();let d=o.path.clone();d.pop(),n.focus(d.append(s))}}),n.keybindings.registerBinding({command:"insert",key:"shift+enter"}),n.commands.registerCommand({id:"create-reference",title:"Create Reference",action:o=>{if(!o.node)return;let i=n.workspace.new("");i.parent=o.node.parent,i.siblingIndex=o.node.siblingIndex+1,i.refTo=o.node,m.redraw.sync();let s=o.path.clone();s.pop(),n.focus(s.append(i))}}),n.commands.registerCommand({id:"delete",title:"Delete node",action:o=>{if(!o.node||o.node.id.startsWith("@"))return;let i=n.workspace.findAbove(o.path);if(o.node.destroy(),m.redraw.sync(),i){let s=0;o.event&&o.event.key==="Backspace"&&(s=i.node.name.length),i.node.childCount===0&&n.workspace.setExpanded(o.path.head,i.node,!1),n.focus(i,s)}}}),n.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),n.commands.registerCommand({id:"prev",action:o=>{if(!o.node)return;let i=n.workspace.findAbove(o.path);i&&n.focus(i)}}),n.keybindings.registerBinding({command:"prev",key:"arrowup"}),n.commands.registerCommand({id:"next",action:o=>{if(!o.node)return;let i=n.workspace.findBelow(o.path);i&&n.focus(i)}}),n.keybindings.registerBinding({command:"next",key:"arrowdown"}),n.commands.registerCommand({id:"pick-command",action:o=>{let i=o.node,s=o.path,d=!1;i||(i=o.path.head,s=new D(o.path.head,o.path.name),d=!0);let l=n.getInput(s),c=l.getBoundingClientRect(),u=r.body.scrollLeft+c.x+l.selectionStart*10+20,p=r.body.scrollTop+c.y-8;d&&(u=r.body.scrollLeft+c.x,p=r.body.scrollTop+c.y+c.height),n.showPalette(u,p,n.newContext({node:i}))}}),n.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),n.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:o=>{o.node&&(n.openNewPanel(o.node),m.redraw())}}),n.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(o,i)=>{n.closePanel(i||o.path),n.context.path=n.mainPanel,m.redraw()}}),n.commands.registerCommand({id:"zoom",title:"Open",action:o=>{n.workspace.lastOpenedID=o.node.id,n.workspace.save(),n.context.path=o.path.append(o.node),n.panels[0]=n.context.path,m.redraw()}}),n.commands.registerCommand({id:"generate-random",title:"Generate Random Children",action:o=>{o.node&&[...Array(100)].forEach(()=>{let i=n.workspace.new(We(8));i.parent=o.node})}}),n.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"indent"},{command:"outdent"},{command:"move-up"},{command:"move-down"},{command:"delete"}]),n.menus.registerMenu("settings",[{title:()=>`${n.backend.auth?.currentUser()?.userID()} @ GitHub`,disabled:!0,when:()=>n.authenticated()},{title:()=>"Login with GitHub",when:()=>!n.authenticated(),onclick:()=>{localStorage.getItem("github")?n.backend.auth.login():n.showNotice("github",()=>{n.backend.auth.login()})}},{title:()=>"Reset Demo",when:()=>!n.authenticated(),onclick:()=>{localStorage.clear(),location.reload()}},{title:()=>"Submit Issue",onclick:()=>window.open("https://github.com/treehousedev/treehouse/issues","_blank")},{title:()=>"Logout",when:()=>n.authenticated(),onclick:()=>n.backend.auth.logout()}]),r.addEventListener("keydown",o=>{let i=n.keybindings.evaluateEvent(o);if(i){n.executeCommand(i.command,n.context),o.stopPropagation(),o.preventDefault();return}o.key==="Escape"&&n.curtain&&n.curtain.onclick&&n.curtain.onclick(o)}),m.mount(e,{view:()=>m(Ne,{workbench:n})})}a(to,"setup");function We(r=10){let e=a((o,i)=>Math.round(Math.random()*(i-o)+o),"random"),t=a(()=>{let o=["got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];return o[e(0,o.length-1)]},"word");return a(o=>[...Array(o)].map((i,s)=>t()).join(" ").trim(),"words")(e(2,r))}a(We,"generateName");export{V as BrowserBackend,te as GitHubBackend,_ as SearchIndex_MiniSearch,to as setup};
//# sourceMappingURL=treehouse.min.js.map
