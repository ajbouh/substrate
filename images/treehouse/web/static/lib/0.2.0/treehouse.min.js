var X=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var B=(r,e,i,t)=>{for(var n=t>1?void 0:t?Z(e,i):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(n=(t?s(e,i,n):s(n))||n);return t&&n&&X(e,i,n),n};var H=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function j(r){if(!r)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",enter:"\u23CE"};return r.toLowerCase().split("+").map(q).map(t=>Object.keys(e).includes(t)?e[t]:t)}function q(r){return!H&&r==="meta"?"ctrl":r}var b=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let i of this.bindings)if(i.command===e)return i;return null}evaluateEvent(e){e:for(let i of this.bindings){let t=i.key.toLowerCase().split("+");if(t.pop()===e.key.toLowerCase()){for(let o of["shift","ctrl","alt","meta"]){let s=t.includes(o);if(!H){if(o==="meta")continue;o==="ctrl"&&(s=t.includes("meta")||t.includes("ctrl"))}let d=e[`${q(o)}Key`];if(!d&&s||d&&!s)continue e}return i}}return null}};var C=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...i){return new Promise(t=>{let n=this.commands[e].action(...i);t(n)})}};var ee={};function E(r){let e=new Error().stack;if(e){let t=e.split(`
`)[3].split("/").pop()?.split(".")[0];r.__module=t}ee[y(r)]=r}function y(r){return r.constructor&&r.constructor.__module&&(r=r.constructor),r.__module?`${r.__module}.${r.name}`:r.name}var w=class{constructor(e,i){this.module=e,this.ID=i}changed(){this.module.changed(this)}get isDestroyed(){return!this.module.nodes.hasOwnProperty(this.ID)}get raw(){return this.module.nodes[this.ID]}getName(){return this.raw.Name}setName(e){this.raw.Name=e,this.changed()}getValue(){return this.raw.Value}getParent(){return this.raw.Parent?new w(this.module,this.raw.Parent):null}setParent(e){let i=this.getParent();i!==null&&i.raw.Linked.Children.splice(this.getSiblingIndex(),1),this.raw.Parent=e.ID,e.raw.Linked.Children.push(this.ID),this.changed()}getChildren(){return this.raw.Linked.Children?this.raw.Linked.Children.map(e=>new w(this.module,e)):[]}childCount(){return this.raw.Linked.Children?this.raw.Linked.Children.length:0}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,i){this.raw.Attrs[e]=i,this.changed()}getSiblingIndex(){let e=this.getParent();return e===null?0:e.raw.Linked.Children.findIndex(i=>i===this.ID)}setSiblingIndex(e){let i=this.getParent();i!==null&&(i.raw.Linked.Children.splice(this.getSiblingIndex(),1),i.raw.Linked.Children.splice(e,0,this.ID),i.changed())}getPrevSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===0?null:e.getChildren()[this.getSiblingIndex()-1]}getNextSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===e.getChildren().length-1?null:e.getChildren()[this.getSiblingIndex()+1]}destroy(){let e=[];this.walk(i=>(e.push(i),!1)),e.reverse().forEach(i=>this.module.destroy(i))}addComponent(e){let i=this.module.new(y(e),e);i.raw.Parent=this.ID,this.raw.Linked.Components.push(i.ID),this.changed()}removeComponent(e){let i=this.getComponentNodes().filter(t=>t.getName()===y(e));i.length>0&&i[0].destroy(),this.changed()}hasComponent(e){return this.getComponentNodes().filter(t=>t.getName()===y(e)).length>0}getComponent(e){let i=this.getComponentNodes().filter(t=>t.getName()===y(e));return i.length>0?i[0].getValue():null}getComponentNodes(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new w(this.module,e)):[]}getPath(){let e=this,i=[];for(;e;)i.unshift(e.getName()),e=e.getParent();return i.join("/")}find(e){return this.module.find([this.getPath(),e].join("/"))}walk(e){if(e(this))return!0;for(let i of this.getChildren())if(i.walk(e))return!0;return!1}},N=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}import(e){for(let i of e)this.nodes[i.ID]=i}export(){let e=[];for(let i of Object.values(this.nodes))e.push(i);return e}new(e,i){let t=null;if(e.includes("/")){let s=0,d=e.split("/");e.startsWith("@")?(t=this.find(d[0]),s=1):t=this.getRoot();for(let l=s;l<d.length-1;l++){if(t===null)throw"unable to get root";let c=t.find(d[l]);c||(c=this.new(d.slice(0,l+1).join("/"))),t=c}e=d[d.length-1]}let n=e.startsWith("@")?e:te();this.nodes[n]={ID:n,Name:e,Value:i,Linked:{Children:[],Components:[]},Attrs:{}};let o=new w(this,n);return t&&o.setParent(t),o}destroy(e){let i=e.getParent();i!==null&&(i.raw.Linked.Children.includes(e.ID)&&i.raw.Linked.Children.splice(e.getSiblingIndex(),1),i.raw.Linked.Components.includes(e.ID)&&i.raw.Linked.Components.splice(e.getSiblingIndex(),1)),delete this.nodes[e.ID],i&&this.changed(i)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new w(this,e.ID))}changed(e){this.observers.forEach(i=>i(e))}getRoot(e){e=e||"@root";let i=this.roots().find(t=>t.getName()===e);return i===void 0?null:i}find(e){let i=this.nodes[e];if(i)return new w(this,i.ID);let t=e.split("/");if(t.length===1&&t[0].startsWith("@"))return null;let n="@root";t[0].startsWith("@")&&(n=t.shift());let o=(d,l)=>d.getChildren().find(c=>c.getName()===l),s=this.find(n);if(!s)return null;for(let d of t){let l=o(s,d);if(!l)return null;s=l}return s}walk(e){for(let i of this.roots())if(i.walk(e))return}},te=()=>{let r=Date.now().toString(36),e=Math.random().toString(36).substring(2);return r+e};var I=class{constructor(){this.menus={}}registerMenu(e,i){this.menus[e]=i}};var S=class{constructor(e){this.id=Math.random().toString(36).substring(2),this.history=[e]}open(e){this.history.push(e)}back(){this.history.pop()}get currentNode(){return this.history[this.history.length-1]}get headNode(){return this.history[0]}},R=class{constructor(e){this.fs=e,this.module=new N,this.expanded={},this.writeDebounce=ne(async(i,t)=>{try{await this.fs.writeFile(i,t),console.log("Saved workspace.")}catch(n){console.error(n),document.dispatchEvent(new CustomEvent("BackendError"))}})}get rawNodes(){return Object.values(this.module.nodes)}get observers(){return this.module.observers}save(){this.writeDebounce("workspace.json",JSON.stringify({version:1,lastopen:this.lastOpenedID,expanded:this.expanded,nodes:this.rawNodes},null,2))}async load(){let e=JSON.parse(await this.fs.readFile("workspace.json")||"{}");Array.isArray(e)&&(e={version:0,nodes:e}),e.nodes&&this.module.import(e.nodes),e.expanded&&(this.expanded=e.expanded),e.lastopen&&(this.lastOpenedID=e.lastopen)}mainNode(){let e=this.module.find("@workspace");if(!e){let i=this.module.find("@root"),t=this.module.new("@workspace");t.setName("Workspace"),t.setParent(i);let n=this.module.new("@calendar");n.setName("Calendar"),n.setParent(t),this.module.new("Home").setParent(t),e=t}return e}find(e){return this.module.find(e)}new(e,i){return this.module.new(e,i)}getExpanded(e,i){this.expanded[e.ID]||(this.expanded[e.ID]={});let t=this.expanded[e.ID][i.ID];return t===void 0&&(t=!1),t}setExpanded(e,i,t){this.expanded[e.ID][i.ID]=t,this.save()}findAbove(e,i){if(i.ID===e.ID)return null;let t=i.getPrevSibling();if(!t)return i.getParent();let n=o=>{if(!this.getExpanded(e,o)||o.childCount()===0)return o;let d=o.getChildren()[o.childCount()-1];return n(d)};return n(t)}findBelow(e,i){if(this.getExpanded(e,i)&&i.childCount()>0)return i.getChildren()[0];let t=n=>{let o=n.getNextSibling();if(o)return o;let s=n.getParent();return!s||s.ID===e.ID?null:t(s)};return t(i)}};function ne(r,e=3e3){let i;return(...t)=>{clearTimeout(i),i=setTimeout(()=>{r.apply(this,t)},e)}}var D=class{constructor(e){this.commands=new C,this.keybindings=new b,this.menus=new I,this.backend=e,this.workspace=new R(e.files),this.context={node:null},this.panels=[[]]}get mainPanel(){return this.panels[0][0]}async initialize(){await this.workspace.load(),this.workspace.rawNodes.forEach(e=>this.backend.index.index(e)),this.workspace.observers.push(e=>{this.workspace.save(),this.backend.index.index(e.raw),e.getComponentNodes().forEach(i=>this.backend.index.index(i.raw))}),this.workspace.lastOpenedID?this.openNewPanel(this.workspace.find(this.workspace.lastOpenedID)||this.workspace.mainNode()):this.openNewPanel(this.workspace.mainNode()),m.redraw(),localStorage.getItem("firsttime")||this.showNotice("firsttime")}authenticated(){return this.backend.auth&&this.backend.auth.currentUser()}closeQuickAdd(){this.quickadd=null,m.redraw()}openQuickAdd(){let e=this.workspace.find("@quickadd");e||(e=this.workspace.new("@quickadd")),this.quickadd=e}commitQuickAdd(){let e=this.workspace.find("@quickadd");if(!e)return;let i=this.todayNode();e.getChildren().forEach(t=>t.setParent(i))}clearQuickAdd(){let e=this.workspace.find("@quickadd");e&&e.getChildren().forEach(i=>i.destroy())}todayNode(){let e=new Date,i=e.toUTCString().split(e.getFullYear())[0],t=`Week ${String(ie(e)).padStart(2,"0")}`,o=["@workspace","Calendar",`${e.getFullYear()}`,t,i].join("/"),s=this.workspace.find(o);return s||(s=this.workspace.new(o)),s}openToday(){this.open(this.todayNode())}open(e){this.workspace.expanded[e.ID]||(this.workspace.expanded[e.ID]={}),this.workspace.lastOpenedID=e.ID,this.workspace.save();let i=new S(e);this.panels[0][0]=i,this.context.panel=i}openNewPanel(e){this.workspace.expanded[e.ID]||(this.workspace.expanded[e.ID]={}),this.workspace.lastOpenedID=e.ID,this.workspace.save();let i=new S(e);this.panels[0].push(i),this.context.panel=i}closePanel(e){this.panels.forEach((i,t)=>{this.panels[t]=i.filter(n=>n!==e)})}defocus(){this.context.node=null}focus(e,i,t=0){this.context.node=e,i&&(this.context.panel=i);let n=this.getInput(e,i);n&&(n.focus(),t!==void 0&&n.setSelectionRange(t,t))}getInput(e,i){return i||(i=this.context.panel),document.getElementById(`input-${i.id}-${e.ID}`)}executeCommand(e,i,...t){return this.commands.executeCommand(e,this.newContext(i),...t)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,i){e.stopPropagation(),e.preventDefault();let t=e.target.closest("*[data-menu]"),n=t.getBoundingClientRect(),o=t.dataset.align||"left",s=document.body.scrollLeft+n.x;o==="right"&&(s=document.body.offsetWidth-n.right);let d=document.body.scrollTop+n.y+n.height,l=this.menus.menus[t.dataset.menu],c=l.filter(u=>u.command).map(u=>this.commands.commands[u.command]);l&&(this.menu={x:s,y:d,ctx:this.newContext(i),items:l,commands:c,align:o},this.curtain={visible:!1,onclick:()=>this.hideMenu()},m.redraw())}hideMenu(){this.menu=null,this.curtain=null,m.redraw()}showPalette(e,i,t){this.palette={x:e,y:i,ctx:t},this.curtain={visible:!1,onclick:()=>this.hidePalette()},m.redraw()}hidePalette(){this.palette=null,this.curtain=null,m.redraw()}showNotice(e,i){this.notice={message:e,finished:i},m.redraw()}hideNotice(){this.notice=null,m.redraw()}};function ie(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),i=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-i);var t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}var U={view({attrs:{workbench:r,x:e,y:i,items:t,align:n,commands:o,ctx:s}}){let d=(c,u)=>f=>{f.stopPropagation(),!c.disabled&&(c.onclick&&c.onclick(),u&&r.executeCommand(u.id,s),r.hideMenu())},l={left:`${e}px`};return n==="right"&&(l={right:`${e}px`}),m("ul",{class:"menu",style:Object.assign(l,{margin:"0",position:"absolute",top:`${i}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.25rem 0 0.25rem 0",display:"inline-block",background:"white",filter:"drop-shadow(2px 2px 4px #5555)",fontSize:"14px",minWidth:"200px",zIndex:"20"})},t.filter(c=>!c.when||c.when()).map(c=>{let u="",f,h;return c.command&&(h=o.find(a=>a.id===c.command),f=r.keybindings.getBinding(h.id),u=h.title),c.title&&(u=c.title()),m("li",{onclick:d(c,h),class:c.disabled?"disabled":"",style:{margin:"0px",listStyleType:"none",padding:"0.25rem 0.5rem 0.25rem 0.5rem",display:"flex"}},m("div",null,u),f&&m("div",{style:{flexGrow:"1",textAlign:"right",color:"#888",marginLeft:"1rem"}},j(f.key).join(" ").toUpperCase()))}))}};var $={onupdate({state:r,dom:e}){let i=e.querySelector(".commands").children;r.selected!==void 0&&i.length>0&&i[r.selected].scrollIntoView({block:"nearest"})},oncreate({dom:r}){r.querySelector("input").focus()},view({attrs:r,state:e}){let i=r.workbench;e.filter=e.filter===void 0?"":e.filter;let n=Object.values(i.commands.commands).filter(d=>d.id.startsWith(e.filter)),o=d=>{let l=(c,u)=>(c%u+u)%u;if(d.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=l(e.selected+1,n.length),!1}if(d.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=l(e.selected-1,n.length),!1;if(d.key==="Enter")return e.selected!==void 0&&(i.commands.executeCommand(n[e.selected].id,r.ctx),i.hidePalette()),!1},s=d=>{e.filter=d.target.value,e.selected=0};return m("div",{class:"palette",style:{margin:"0",position:"absolute",left:`${r.x}px`,top:`${r.y}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.5rem",background:"white",fontSize:"14px",minWidth:"400px",zIndex:"20"}},m("div",null,m("input",{style:{width:"98%",outline:"0",border:"0"},type:"text",onkeydown:o,oninput:s,placeholder:"Enter command..."})),m("div",{class:"commands",style:{margin:"0.25rem",overflowY:"scroll",maxHeight:"200px",position:"relative"}},n.map((d,l)=>m("div",{style:{padding:"0.25rem"},class:e.selected===l?"selected":""},d.title||d.id))))}};var W={view({attrs:r,state:e,children:i}){let{node:t,panel:n,workbench:o}=r,s=o.workspace.getExpanded(n.headNode,t),d=a=>{e.hover=!0,a.stopPropagation()},l=a=>{e.hover=!1,a.stopPropagation()},c=a=>{s?o.executeCommand("collapse",{node:t,panel:n}):o.executeCommand("expand",{node:t,panel:n}),a.stopPropagation()},u=a=>{let v=a.shiftKey||a.metaKey||a.altKey||a.ctrlKey;switch(a.key){case"ArrowUp":a.target.selectionStart!==0&&!v&&a.stopPropagation();break;case"ArrowDown":a.target.selectionStart!==a.target.value.length&&a.target.selectionStart!==0&&!v&&a.stopPropagation();break;case"Backspace":if(a.target.value===""){if(a.preventDefault(),a.stopPropagation(),t.childCount()>0)return;o.executeCommand("delete",{node:t,panel:n,event:a});return}if(a.target.value!==""&&a.target.selectionStart===0&&a.target.selectionEnd===0){a.preventDefault(),a.stopPropagation();let k=o.workspace.findAbove(n.headNode,t);if(!k)return;let F=k.getName();k.setName(F+a.target.value),t.destroy(),m.redraw.sync(),o.focus(k,n,F.length);return}break;case"Enter":if(a.preventDefault(),a.ctrlKey||a.shiftKey||a.metaKey||a.altKey)return;if(a.target.selectionStart===a.target.value.length){t.childCount()>0&&o.workspace.getExpanded(n.headNode,t)?o.executeCommand("insert-child",{node:t,panel:n},"",0):o.executeCommand("insert",{node:t,panel:n}),a.stopPropagation();return}if(a.target.selectionStart===0){o.executeCommand("insert-before",{node:t,panel:n}),a.stopPropagation();return}if(a.target.selectionStart>0&&a.target.selectionStart<a.target.value.length){o.executeCommand("insert",{node:t,panel:n},a.target.value.slice(a.target.selectionStart)).then(()=>{t.setName(a.target.value.slice(0,a.target.selectionStart))}),a.stopPropagation();return}break}},f=a=>{let v=t.getComponent(g);v.checked=!v.checked,t.changed()},h=a=>{a.preventDefault(),a.stopPropagation(),o.executeCommand("open",{node:t,panel:n}),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()};return m("div",{onmouseover:d,onmouseout:l},m("div",{style:{display:"flex",flexDirection:"row",alignItems:"start",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",position:"absolute",marginLeft:"-1rem",userSelect:"none",marginTop:"0.25rem",display:e.hover?"block":"none"},onclick:a=>o.showMenu(a,{node:t,panel:n}),oncontextmenu:a=>o.showMenu(a,{node:t,panel:n}),"data-menu":"node",fill:"lightgray",viewBox:"0 0 16 16"},m("path",{style:{transform:"translateY(-1px)"},"fill-rule":"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"})),m("svg",{onclick:c,ondblclick:h,oncontextmenu:a=>o.showMenu(a,{node:t,panel:n}),"data-menu":"node",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px",marginTop:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},t.childCount()>0&&!s?m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}):null,m("circle",{cx:"8",cy:"7",r:"3"})),m("div",{style:{flexGrow:"1",display:"flex",alignItems:"start"}},t.hasComponent(g)?m("input",{type:"checkbox",style:{marginTop:"0.3rem",marginRight:"0.5rem"},onclick:f,checked:t.getComponent(g).checked}):null,m(M,{workbench:o,panel:n,node:t,onkeydown:u}))),s===!0&&m("div",{style:{display:"flex",flexDirection:"row",paddingBottom:"0.25rem"}},m("div",{style:{width:"var(--8)",display:"flex"},onclick:c}),m("div",{style:{flexGrow:"1"}},t.childCount()>0?t.getChildren().map(a=>m(W,{key:a.ID,workbench:o,panel:n,node:a})):m(G,{workbench:o,panel:n,node:t}))))}},G={view({attrs:{workbench:r,panel:e,node:i}}){return m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),m("path",{fill:"#555",style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",oninput:o=>{r.executeCommand("insert-child",{node:i,panel:e},o.target.value)},onkeydown:o=>{if(o.key==="Tab"&&(o.stopPropagation(),o.preventDefault(),i.childCount()>0)){let s=i.getChildren()[i.childCount()-1];r.executeCommand("insert-child",{node:s,panel:e})}},value:"",style:{border:"0px",flexGrow:"1",outline:"0px"}})))}},P={view({attrs:{workbench:r,panel:e,node:i},state:t}){return m("div",{style:{color:"var(--gray-900)"}},i.getChildren().map(n=>m(W,{key:n.ID,workbench:r,panel:e,node:n})),m(G,{workbench:r,panel:e,node:i}))}},M={oncreate({dom:r}){let e=r.querySelector("textarea"),i=e.offsetHeight,t=r.querySelector("span");this.updateHeight=()=>{t.style.width=`${Math.max(e.offsetWidth,100)}px`,t.innerHTML=e.value.replace(`
`,"<br/>"),e.style.height=t.offsetHeight>0?`${t.offsetHeight}px`:`${i}px`},e.addEventListener("input",()=>this.updateHeight()),e.addEventListener("blur",()=>t.innerHTML=""),setTimeout(()=>this.updateHeight(),50)},onupdate(){this.updateHeight()},view({attrs:{workbench:r,node:e,panel:i,onkeydown:t,disallowEmpty:n},state:o}){let s=o.editing?o.buffer:e.getName(),d=h=>{h.key==="Enter"&&(h.preventDefault(),h.stopPropagation())},l=h=>{o.initialValue=e.getName(),r.context.node=e,o.editing=!0,o.buffer=e.getName()},c=h=>{o.editing&&(o.editing=!1,e.isDestroyed||(n&&o.buffer.length===0?e.setName(o.initialValue):e.setName(o.buffer)),o.buffer=void 0,r.context.node=null)},u=h=>{o.buffer=h.target.value,n&&o.buffer.length===0?e.setName(o.initialValue):e.setName(o.buffer)},f={outline:"none",color:"inherit",fontSize:"inherit",fontWeight:"inherit",fontFamily:"inherit",padding:"0",width:"100%",boxSizing:"border-box",resize:"none",overflow:"hidden",display:"block",lineHeight:"1.45",border:"none"};return m("div",{style:{width:"100%",marginBottom:"0.5rem"}},m("textarea",{style:f,id:`input-${i.id}-${e.ID}`,rows:"1",onfocus:l,onblur:c,oninput:u,onkeydown:t||d,value:s},s),m("span",{style:Object.assign({visibility:"hidden",position:"fixed"},f)}))}};var K={view({attrs:r}){let e=r.panel,i=r.workbench,t=e.currentNode,n=c=>{i.executeCommand("close-panel",{},e)},o=c=>{e.back()},s=c=>{i.panels=[[e]],i.context.panel=e},d=c=>{t.getComponent(p).markdown=c.target.value,t.changed()};function l(c=""){return 20+(c.match(/\n/g)||[]).length*20}return m("div",{class:"panel flex flex-col grow",style:{marginTop:"var(--4)",marginLeft:"var(--12)",marginRight:"var(--12)",paddingBottom:"var(--padding)"}},m("div",{class:"bar",style:{display:"flex",fontSize:"0.875rem",color:"var(--gray-600)",gap:"var(--padding)",marginBottom:"var(--8)"}},e.history.length>1?m("div",{style:{rightPadding:"var(--padding)"}},m("svg",{onclick:o,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{style:{flexGrow:"1"}},t.getParent()&&t.getParent().ID!=="@root"?m("span",{style:{cursor:"pointer"},onclick:()=>i.open(t.getParent())},t.getParent().getName()):m("span",null,"/")),i.panels.flat().length>1?m("div",{style:{display:"flex",gap:"var(--4)",zIndex:"0",color:"var(--gray-500)",alignItems:"center"}},m("svg",{onclick:s,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-maximize-2"},m("polyline",{points:"15 3 21 3 21 9"}),m("polyline",{points:"9 21 3 21 3 15"}),m("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),m("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),m("svg",{onclick:n,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},m("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null),m("div",{class:"body flex flex-col"},m("div",{oncontextmenu:c=>i.showMenu(c,{node:t,panel:e}),"data-menu":"node",style:{fontSize:"var(--6)",color:"var(--gray-900)",fontWeight:"700"}},m(M,{workbench:i,panel:e,node:t,disallowEmpty:!0})),t.hasComponent(p)?m("textarea",{oninput:d,value:t.getComponent(p).markdown,placeholder:"Enter Markdown text here",style:{marginLeft:"var(--padding)",padding:"var(--padding)",outline:"0",height:`${l(t.getComponent(p).markdown)}px`,border:"0"}},t.getComponent(p).markdown):null,m(P,{workbench:i,panel:e,node:t})))}};var Q={view({attrs:{workbench:r}}){let e={id:"quickadd",headNode:r.quickadd};return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>r.closeQuickAdd(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",width:"45vw",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m("h3",{style:{margin:"0"}},"Quick Add"),m("hr",null),m(P,{workbench:r,node:r.quickadd,panel:e}),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem"},onclick:()=>{r.commitQuickAdd(),r.closeQuickAdd()}},"Add to Today"))))}};var V={onupdate({state:r,dom:e}){let i=e.querySelector(".results");i&&r.selected!==void 0&&i.children.length>0&&i.children[r.selected].scrollIntoView({block:"nearest"})},view({attrs:{workbench:r},state:e}){e.query=e.query===void 0?"":e.query,e.results=e.results===void 0?[]:e.results;let i=()=>{e.query="",e.results=[],r.curtain=null},t=s=>{r.open(s),i()},n=s=>{let d=(l,c)=>(l%c+c)%c;if(s.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=d(e.selected+1,e.results.length),!1}if(s.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=d(e.selected-1,e.results.length),!1;if(s.key==="Enter")return e.selected!==void 0&&t(e.results[e.selected]),!1;s.key==="Escape"&&i()},o=s=>{e.query=s.target.value,e.selected=0,e.query?e.results=r.backend.index.search(e.query).map(d=>{let l=r.workspace.find(d);if(l&&!(l.getValue()&&(l=l.getParent(),!l.raw)))return l}).filter(d=>d!==void 0):e.results=[],e.query&&e.results.length>0?r.curtain={visible:!1,onclick:()=>i()}:r.curtain=null};return m("div",{class:"search",style:{position:"relative",display:"flex",flexGrow:"1",marginLeft:"var(--padding)",marginRight:"var(--padding)"}},m("div",{style:{width:"95%",padding:"calc(var(--padding)/2)",margin:"calc(var(--padding)/-2)",borderRadius:"0.25rem",border:e.results.length>0?"1px solid var(--dark)":"none",position:"absolute",zIndex:e.results.length>0?"100":"1",background:e.results.length>0?"white":null}},m("div",{class:"flex",style:{margin:e.results.length>0?"0":"1px"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),m("input",{type:"text",placeholder:"Search",value:e.query,onkeydown:n,oninput:o,style:{width:"99%",border:"0",outline:"0",background:"transparent",marginLeft:"var(--1)",marginRight:"var(--padding)"}})),e.results.length>0?m("div",{class:"results",style:{marginLeft:"20px",paddingLeft:"var(--1)",marginTop:"0.25rem",overflowX:"hidden",fontWeight:"400",overflowY:"auto",maxHeight:"400px"}},e.results.map((s,d)=>m("div",{onclick:()=>t(s),class:e.selected===d?"selected":""},s.getName()))):null))}};var oe={view({attrs:{workbench:r,finished:e}}){return m("div",null,m("h3",{style:{margin:"0"}},"Refresh to view latest updates"),m("hr",null),m("p",null,"Your notes were updated in another browser session. Refresh the page to view the latest version."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{e()}},"Refresh Now")))}},re={view({attrs:{workbench:r}}){return m("div",null,m("h3",{style:{margin:"0"}},"Treehouse is under active development"),m("hr",null),m("p",null,"This is a preview based on our main branch, which is actively being developed."),m("p",null,"If you find a bug, please report it via [ ",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.25rem",marginRight:"0.25rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}))," > Submit Issue ]."),m("p",null,"Data is stored using localstorage, which you can reset via [ ",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.25rem",marginRight:"0.25rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}))," > Reset Demo ]."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{localStorage.setItem("firsttime","1"),r.hideNotice()}},"Got it")))}},se={view({attrs:{workbench:r,finished:e}}){return m("div",null,m("h3",{style:{margin:"0"}},"Login with GitHub"),m("hr",null),m("p",null,"The GitHub backend is experimental so use at your own risk!"),m("p",null,"To store your workbench we will create a public repository called ",m("pre",{style:{display:"inline"}},"<username>.treehouse.sh")," if it doesn't already exist. You can manually make this repository private via GitHub if you want."),m("p",null,"You can Logout via the",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.5rem",marginRight:"0.5rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})),"menu in the top right to return to the localstorage backend."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{r.hideNotice(),localStorage.setItem("github","1"),e()}},"Login with GitHub"),m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{r.hideNotice()}},"Cancel")))}},Y={view({attrs:{workbench:r,message:e,finished:i}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",fontSize:"1.25rem",width:"680px",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m({firsttime:re,github:se,lockstolen:oe}[e],{workbench:r,finished:i})))}};var _={view({attrs:{workbench:r},state:e}){e.open=e.open===void 0?!0:e.open;let i=t=>{e.open?e.open=!1:e.open=!0};return m("main",{class:"workbench m-0 flex flex-row absolute inset-0",style:{overflow:"none"}},m("div",{class:"sidebar flex flex-col",style:{width:e.open?"256px":"52px",borderRight:"1px solid var(--gray-200)",backgroundColor:"var(--gray-100)"}},m("div",{style:{padding:"var(--padding)",borderBottom:"1px solid var(--gray-200)",height:"56px"}},m("img",{src:"/icon_transparent.png",style:{opacity:"40%",width:"20px",height:"20px"}})),m("div",{class:"grow",style:{padding:"var(--padding)",color:"var(--gray-900)",fontWeight:"500"}},e.open&&r.workspace.module.getRoot().getChildren().map(t=>m(J,{node:t,expanded:!0,level:0,workbench:r}))),m("div",{style:{padding:"var(--padding)",color:"var(--gray-500)"}},m("svg",{onclick:i,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sidebar"},m("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"9",y1:"3",x2:"9",y2:"21"})))),m("div",{class:"main flex flex-col",style:{flexGrow:"1"}},m("div",{class:"topbar flex",style:{padding:"var(--padding)",paddingLeft:"calc(var(--padding)*2)",paddingRight:"calc(var(--padding)*2)",lineHeight:"1",fontSize:"0.875rem",color:"var(--gray-900)",fontWeight:"600",borderBottom:"1px solid var(--gray-200)",height:"56px"}},m("div",{onclick:()=>r.openToday(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"var(--1)"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar"},m("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m("line",{x1:"3",y1:"10",x2:"21",y2:"10"})),m("div",null,"Today")),m("div",{onclick:()=>r.openQuickAdd(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"var(--1)"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-circle"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),m("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),m("div",null,"Quick Add")),m(V,{workbench:r}),m("div",{onclick:t=>r.showMenu(t),"data-menu":"settings","data-align":"right",style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})))),m("div",{class:"panels flex flex-row",style:{position:"relative",overflow:"hidden"}},r.panels.map(t=>t.map(n=>m("div",{style:{borderRight:"1px solid var(--gray-200)",flex:"1 1 auto",overflowY:"auto"}},m(K,{workbench:r,panel:n})))))),r.curtain&&m("div",{onclick:r.curtain.onclick,style:{zIndex:"10",position:"absolute",background:"black",opacity:r.curtain.visible?"50%":"0%",width:"100%",height:"100%"}}),r.menu&&m(U,{workbench:r,...r.menu}),r.palette&&m($,{workbench:r,...r.palette}),r.quickadd&&m(Q,{workbench:r}),r.notice&&m(Y,{workbench:r,...r.notice}))}},J={view({attrs:{node:r,workbench:e,expanded:i,level:t},state:n}){n.expanded=n.expanded===void 0?i:n.expanded;let o=r.childCount()>0&&t<3,s=l=>{o&&(n.expanded?n.expanded=!1:n.expanded=!0,l.stopPropagation())},d=l=>{e.open(r)};return m("div",null,m("div",{style:{display:"flex",paddingBottom:"var(--1)",paddingTop:"var(--1)"}},m("svg",{onclick:s,style:{cursor:"pointer",flexShrink:"0",paddingTop:"0px",marginRight:"0.125rem"},class:"feather feather-chevron-right",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",xmlns:"http://www.w3.org/2000/svg"},o?n.expanded?m("polyline",{points:"6 9 12 15 18 9"}):m("polyline",{points:"9 18 15 12 9 6"}):null),m("div",{onclick:d,style:{cursor:"pointer",lineHeight:"1.25",fontSize:"0.875rem",flexGrow:"1",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},r.getName())),n.expanded&&m("div",{style:{marginLeft:"0.5rem"}},r.getChildren().filter(l=>l.getName()!=="").map(l=>m(J,{workbench:e,node:l,level:t+1}))))}};var x=class{constructor(){this.auth=null,this.files=new T,window.MiniSearch?this.index=new L:this.index=new A}},L=class{constructor(){this.indexer=new MiniSearch({idField:"ID",fields:["ID","Name","Value.markdown"],storeFields:["ID"],extractField:(e,i)=>i.split(".").reduce((t,n)=>t&&t[n],e)})}index(e){this.indexer.has(e.ID)?this.indexer.replace(e):this.indexer.add(e)}remove(e){this.indexer.discard(e)}search(e){let i=this.indexer.autoSuggest(e);return i.length===0?[]:this.indexer.search(i[0].suggestion).map(t=>t.ID)}},A=class{constructor(){this.nodes={}}index(e){this.nodes[e.ID]=e.Name}remove(e){delete this.nodes[e]}search(e){let i=[];for(let t in this.nodes)this.nodes[t].includes(e)&&i.push(t);return i}},T=class{async readFile(e){return localStorage.getItem(`treehouse:${e}`)}async writeFile(e,i){localStorage.setItem(`treehouse:${e}`,i)}};import{encode as ae,decode as de}from"https://cdn.jsdelivr.net/npm/js-base64@3.7.5/base64.mjs";var O=class{constructor(e,i){this.loginURL=e,this.clientFactory=i,this.auth=this,this.shas={};let t=new x;this.index=t.index,this.files=t.files}get repo(){return`${this.user?.userID()}.treehouse.sh`}async initialize(){let e=new URL(location.href).searchParams.get("code");if(e)try{let n=location.search.replace(/\bcode=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${n}`);let s=await(await fetch(this.loginURL,{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({code:e})})).json();if(s.error)throw s.error;localStorage.setItem("treehouse:gh-token",s.token)}catch(n){this.reset(),console.error(n);return}if(await this.authenticate(),!this.user){console.error("authentication failed");return}try{await this.client.rest.repos.get({owner:this.user.userID(),repo:this.repo})}catch(n){if(n.message!=="Not Found")throw n;console.log("Creating repository...");let o=await this.client.rest.repos.createForAuthenticatedUser({name:this.repo});if(o.status!==201){console.error(o);return}}try{await this.client.rest.repos.getContent({owner:this.user.userID(),repo:this.repo,path:"workspace.json"})}catch(n){if(n.name!=="HttpError")throw n;console.log("Creating workspace.json...");let o=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user.userID(),repo:this.repo,path:"workspace.json",message:"initial commit",content:btoa(JSON.stringify([]))});if(o.status!==201){console.error(o);return}}this.files=this;let i=le();await this.readFile("treehouse.lock"),await this.writeFile("treehouse.lock",i);let t=setInterval(async()=>{await this.readFile("treehouse.lock")!==i&&(clearInterval(t),document.dispatchEvent(new CustomEvent("BackendError")),console.warn("lock stolen!"))},5e3)}async authenticate(){let e=localStorage.getItem("treehouse:gh-token");if(!e)return;this.client=new this.clientFactory({auth:e});let i=await this.client.rest.users.getAuthenticated();!i||i.error||(this.user=new z(i.data),m&&m.redraw())}currentUser(){return this.user}login(){location.assign(this.loginURL)}reset(){localStorage.removeItem("treehouse:gh-token"),this.user=null,m&&m.redraw()}logout(){this.reset(),location.reload()}async readFile(e){try{let i=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:e,random:Math.random().toString(36).substring(2)});return this.shas[e]=i.data.sha,de(i.data.content)}catch(i){return i.name!=="HttpError"&&console.error(i),null}}async writeFile(e,i){let t=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user?.userID(),repo:this.repo,path:e,message:"autosave",content:ae(i),sha:this.shas[e]});this.shas[e]=t.data.content.sha}},z=class{constructor(e){this.user=e}userID(){return this.user.login}displayName(){return this.user.name}avatarURL(){return this.user.avatar_url}};function le(){let r=Date.now().toString(36),e=Math.random().toString(36).substring(2);return r+e}var g=class{constructor(){this.checked=!1}};g=B([E],g);var p=class{constructor(){this.markdown=""}};p=B([E],p);async function Xe(r,e,i){i.initialize&&await i.initialize();let t=new D(i);window.workbench=t,await t.initialize(),r.addEventListener("BackendError",()=>{t.showNotice("lockstolen",()=>{location.reload()})}),t.commands.registerCommand({id:"add-page",title:"Add page",action:n=>{if(!n.node)return;let o=new p;n.node.addComponent(o)}}),t.commands.registerCommand({id:"remove-page",title:"Remove page",action:n=>{n.node&&n.node.removeComponent(p)}}),t.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",action:n=>{if(!n.node)return;let o=new g;n.node.addComponent(o)}}),t.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",action:n=>{n.node&&n.node.removeComponent(g)}}),t.commands.registerCommand({id:"mark-done",title:"Mark done",action:n=>{if(n.node)if(n.node.hasComponent(g)){let o=n.node.getComponent(g);o.checked?n.node.removeComponent(g):(o.checked=!0,n.node.changed())}else{let o=new g;n.node.addComponent(o)}}}),t.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),t.commands.registerCommand({id:"expand",title:"Expand",action:n=>{n.node&&(t.workspace.setExpanded(n.panel.headNode,n.node,!0),m.redraw())}}),t.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),t.commands.registerCommand({id:"collapse",title:"Collapse",action:n=>{n.node&&(t.workspace.setExpanded(n.panel.headNode,n.node,!1),m.redraw())}}),t.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),t.commands.registerCommand({id:"indent",title:"Indent",action:n=>{if(!n.node)return;let o=n.node.getPrevSibling();if(o!==null){n.node.setParent(o),t.workspace.setExpanded(n.panel.headNode,o,!0);let s=n.node;m.redraw.sync(),t.focus(s)}}}),t.keybindings.registerBinding({command:"indent",key:"tab"}),t.commands.registerCommand({id:"outdent",title:"Outdent",action:n=>{if(!n.node)return;let o=n.node.getParent();if(o!==null&&o.ID!=="@root"){n.node.setParent(o.getParent()),n.node.setSiblingIndex(o.getSiblingIndex()+1),o.childCount()===0&&t.workspace.setExpanded(n.panel.headNode,o,!1);let s=n.node;m.redraw.sync(),t.focus(s)}}}),t.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),t.commands.registerCommand({id:"move-up",title:"Move Up",action:n=>{if(!n.node)return;let o=n.node,s=o.getParent();if(s!==null&&s.ID!=="@root"){let d=s.childCount();if(o.getSiblingIndex()===0){if(!s.getPrevSibling())return;let l=s.getPrevSibling();o.setParent(l),o.setSiblingIndex(l.childCount()-1),t.workspace.setExpanded(n.panel.headNode,l,!0),m.redraw.sync(),t.focus(o)}else{if(d===1)return;o.setSiblingIndex(o.getSiblingIndex()-1),m.redraw.sync()}}}}),t.keybindings.registerBinding({command:"move-up",key:"shift+meta+arrowup"}),t.commands.registerCommand({id:"move-down",title:"Move Down",action:n=>{if(!n.node)return;let o=n.node,s=o.getParent();if(s!==null&&s.ID!=="@root"){let d=s.childCount();if(o.getSiblingIndex()===d-1){if(!s.getNextSibling())return;let l=s.getNextSibling();o.setParent(l),o.setSiblingIndex(0),t.workspace.setExpanded(n.panel.headNode,l,!0),m.redraw.sync(),t.focus(o)}else{if(d===1)return;o.setSiblingIndex(o.getSiblingIndex()+1),m.redraw.sync()}}}}),t.keybindings.registerBinding({command:"move-down",key:"shift+meta+arrowdown"}),t.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(n,o="",s)=>{if(!n.node)return;let d=t.workspace.new(o);d.setParent(n.node),s!==void 0&&d.setSiblingIndex(s),t.workspace.setExpanded(n.panel.headNode,n.node,!0),m.redraw.sync(),t.focus(d,n.panel,o.length)}}),t.commands.registerCommand({id:"insert-before",title:"Insert Before",action:n=>{if(!n.node)return;let o=t.workspace.new("");o.setParent(n.node.getParent()),o.setSiblingIndex(n.node.getSiblingIndex()),m.redraw.sync(),t.focus(o,n.panel)}}),t.commands.registerCommand({id:"insert",title:"Insert Node",action:(n,o="")=>{if(!n.node)return;let s=t.workspace.new(o);s.setParent(n.node.getParent()),s.setSiblingIndex(n.node.getSiblingIndex()+1),m.redraw.sync(),t.focus(s,n.panel)}}),t.keybindings.registerBinding({command:"insert",key:"shift+enter"}),t.commands.registerCommand({id:"delete",title:"Delete node",action:n=>{if(!n.node||n.node.ID.startsWith("@"))return;let o=t.workspace.findAbove(n.panel.headNode,n.node);if(n.node.destroy(),m.redraw.sync(),o){let s=0;n.event&&n.event.key==="Backspace"&&(s=o.getName().length),o.childCount()===0&&t.workspace.setExpanded(n.panel.headNode,o,!1),t.focus(o,n.panel,s)}}}),t.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),t.commands.registerCommand({id:"prev",action:n=>{if(!n.node)return;let o=t.workspace.findAbove(n.panel.headNode,n.node);o&&t.focus(o,n.panel)}}),t.keybindings.registerBinding({command:"prev",key:"arrowup"}),t.commands.registerCommand({id:"next",action:n=>{if(!n.node)return;let o=t.workspace.findBelow(n.panel.headNode,n.node);o&&t.focus(o,n.panel)}}),t.keybindings.registerBinding({command:"next",key:"arrowdown"}),t.commands.registerCommand({id:"pick-command",action:n=>{let o=n.node,s=!1;o||(o=n.panel.headNode,s=!0);let d=t.getInput(o),l=d.getBoundingClientRect(),c=r.body.scrollLeft+l.x+d.selectionStart*10+20,u=r.body.scrollTop+l.y-8;s&&(c=r.body.scrollLeft+l.x,u=r.body.scrollTop+l.y+l.height),t.showPalette(c,u,t.newContext({node:o}))}}),t.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),t.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:n=>{n.node&&(t.openNewPanel(n.node),m.redraw())}}),t.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(n,o)=>{t.closePanel(o||n.node.panel),t.context.panel=t.mainPanel,m.redraw()}}),t.commands.registerCommand({id:"open",title:"Open",action:n=>{n.panel.open(n.node),t.workspace.lastOpenedID=n.node.ID,t.workspace.save(),m.redraw()}}),t.commands.registerCommand({id:"generate-random",title:"Generate Random Children",action:n=>{n.node&&[...Array(100)].forEach(()=>{t.workspace.new(ce(8)).setParent(n.node)})}}),t.menus.registerMenu("node",[{command:"open"},{command:"new-panel"},{command:"indent"},{command:"outdent"},{command:"move-up"},{command:"move-down"},{command:"delete"},{command:"mark-done"},{command:"add-page"},{command:"generate-random"}]),t.menus.registerMenu("settings",[{title:()=>`${t.backend.auth?.currentUser()?.userID()} @ GitHub`,disabled:!0,when:()=>t.authenticated()},{title:()=>"Login with GitHub",when:()=>!t.authenticated(),onclick:()=>{localStorage.getItem("github")?t.backend.auth.login():t.showNotice("github",()=>{t.backend.auth.login()})}},{title:()=>"Reset Demo",when:()=>!t.authenticated(),onclick:()=>{localStorage.clear(),location.reload()}},{title:()=>"Submit Issue",onclick:()=>window.open("https://github.com/treehousedev/treehouse/issues","_blank")},{title:()=>"Logout",when:()=>t.authenticated(),onclick:()=>t.backend.auth.logout()}]),r.addEventListener("keydown",n=>{let o=t.keybindings.evaluateEvent(n);if(o){t.commands.executeCommand(o.command,t.context),n.stopPropagation(),n.preventDefault();return}n.key==="Escape"&&t.curtain&&t.curtain.onclick&&t.curtain.onclick(n)}),m.mount(e,{view:()=>m(_,{workbench:t})})}function ce(r=10){let e=(n,o)=>Math.round(Math.random()*(o-n)+n),i=()=>{let n=["got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];return n[e(0,n.length-1)]};return(n=>[...Array(n)].map((o,s)=>i()).join(" ").trim())(e(2,r))}export{x as BrowserBackend,g as Checkbox,O as GitHubBackend,p as Page,L as SearchIndex_MiniSearch,Xe as setup};
